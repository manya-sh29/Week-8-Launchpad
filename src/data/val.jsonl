{"instruction": "Answer the following programming question.", "input": "I have a web app on GAE written in Go that performs some calculations for the user. The website communicates with the server through a simple HTTP Post. I want to let the user be able to share a link to the result they obtained without changing much in my Go code.\nIs there some way to encode a HTTP Post message as a website url that would execute on the app engine as if the user sent the Post from the website?\nHow would the code for a button that would copy the proper link to user's clipboard (noting that the field values can change between page being loaded and user wanting the link, so hard-coding the values through GAE parser wouldn't work).", "output": "Use a GET instead of a POST. That's the point of GET : it generates a bookmarkable URL.\nGET should always be used for idempotent operations, unless the sent data contain secret information or are too large to be put into GET parameters."}
{"instruction": "Answer the following programming question.", "input": "https://developers.google.com/drive/v2/reference/files/list\nAre there Go examples using the code.google.com/p/google-api-go-client/drive/v2 package. Is there another location for it? or just not released yet?", "output": "It is not yet released, but you can build the client yourself, if you have the library installed with:\ngo get code.google.com/p/google-api-go-client/drive/v1\ncd $GOPATH/src/code.google.com/p/google-api-go-client\ngo run google-api-go-generator/gen.go -api=drive:v2\ngo install ./drive/v2\n\nI will submit a patch right now to get it added."}
{"instruction": "Answer the following programming question.", "input": "I am running a server with Go programming language, and when I load the server in the browser, the temp handler function is called and the getjson.html file is served by this temp Handler function. Now the screen shows a \"Get Json Data\" button. On clicking this button, I am not getting any results (as something should be displayed on the screen).\nI checked the javascript console and there are no errors as such. \nI am not able to figure out what the problem is, why isn't there any output on the screen.\nContents of servejson.go : \npackage main\n\nimport (\n    \"http\"\n    \"flag\"\n)\n\nvar path = flag.String(\"root\", \"/home/chinmay/work/json/getjson.html\", \"Set root directory, use absolute path\")\n\nfunc temp(w http.ResponseWriter, r *http.Request){\n    w.Header().Set(\"Content-Type\", \"text/html\")\n    http.ServeFile(w,r,*path)\n}\n\nfunc main(){\n    http.HandleFunc(\"/\",temp)\n    http.ListenAndServe(\":8080\", nil)\n}\n\nContents of getjson.html : \npackage main\n\nimport (\n    \"http\"\n    \"flag\"\n)\n\nvar path = flag.String(\"root\", \"/home/chinmay/work/json/getjson.html\", \"Set root directory, use absolute path\")\n\nfunc temp(w http.ResponseWriter, r *http.Request){\n    w.Header().Set(\"Content-Type\", \"text/html\")\n    http.ServeFile(w,r,*path)\n}\n\nfunc main(){\n    http.HandleFunc(\"/\",temp)\n    http.ListenAndServe(\":8080\", nil)\n}\n\nContents of json_data.js:\n{ \n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\",\n  \"age\": 25\n}", "output": "Yes, you can. Live example. Provided that json.txt is a resource next to the document in which this code is running, and (on some browsers) provided this is not running from a local file (e.g., a file:// URL rather than an http:// one; some browsers are okay with local files accessing other local files via ajax, others are not).\nA couple of notes:\n\nIn the\n$(\"div\").append(field + \" \");\n\nline, field will be the value of each property (e.g., \"John\").\nThe order in which the properties are listed is completely undefined.\n\nSo for this specific example, you'd probably be better off with\n<script type=\"text/javascript\">\n$(document).ready(function(){\n  $(\"button\").click(function(){\n    $.getJSON(\"json.txt\",function(result){\n      $(\"div\").append(result.firstName + \" \" + result.lastName + \" \" + result.age);\n    });\n  });\n});\n</script>\n\nLive example\n\nUpdate: From your comments on another answer, it seems like you might be unclear on where and how the script code is running. The JavaScript script runs on the client's browser. The path to use to reference json.txt is exactly like (say) the path to an image you want to show on a page. json.txt must be accessible via the web server, just like an image would need to be accessible via the web server. Think of json.txt as just another resource used by your web page, like any other. In terms of the path, and how you have to make json.txt available, the same rules apply. To be clear: Script running client-side in a web page cannot access a server-side file that can't be retrieved by the browser.\n\nUpdate 2: You've posted more code, and it looks like you've made your server only serve the getjson.html file. Your server also has to serve the json.txt file, or the browser can't access it."}
{"instruction": "Answer the following programming question.", "input": "I've been trying to run a GAE Go project I developed on my Mac on my Windows machine with GoClipse after installing and configuring the appropriate SDKs and so forth. When attempting to run the project, I get this error:\n\nException occurred executing command line. Cannot run program\n  \"C:\\GoogleAppEngine\\dev_appserver.py\" (in directory\n  \"D:\\Golang\\workspace\\Project\\src\\pkg\"): CreateProcess\n  error=193, %1 is not a valid Win32 application\n\nHow can I fix that error in order to run my project?", "output": "While the below configuration works on the Mac as it has Python installed by default, Windows requires a different configuration.\nOn Mac the GoClipse External Tools Configuration would be:\nLocation: /GoogleAppEngine/dev_appserver.py\nWorking Directory: ${workspace_loc:/Project/src/pkg}\nArguments: .\n\nThe Windows configuration should look like:\nLocation: C:\\Python27\\Python.exe\nWorking Directory:\nArguments: C:\\GoogleAppEngine\\dev_appserver.py \"${workspace_loc:/Project/src/pkg}\""}
{"instruction": "Answer the following programming question.", "input": "If you look at the image package here http://golang.org/src/pkg/image/image.go you can see that the implementation of Opaque() for every image does the same thing, differing only in the pixel-specific logic.\nIs there a reason for this?  Would any general solution be less efficient?  Is it just an oversight?  Is there some limitation (I cannot see one) to the type system that would make a polymorphic [was: generic] approach difficult?\n[edit] The kind of solution I was thinking of (which does not need generics in the Java sense) would be like:\n\ntype ColorPredicate func(c image.Color) bool;\n\nfunc AllPixels (p *image.Image, q ColorPredicate) bool {\n  var r = p.Bounds()\n  if r.Empty() {\n    return true\n  }\n  for y := r.Min.Y; y < r.Max.Y; y++ {\n    for x := r.Min.X; x < r.Max.X; x++ {\n      if ! q(p.At(x,y)) {\n        return false\n      }\n    }\n  }\n  return true\n}\n\nbut I am having trouble getting that to compile (still very new to Go - it will compile with an image, but not with an image pointer!).\nIs that too hard to optimise?  (you would need to have function inlining, but then wouldn't any type checking be pulled out of the loop?).  Also, I now realise I shouldn't have used the word \"generic\" earlier - I meant it only in a generic (ha) way.", "output": "There is a limitation to the type system which prevents a general solution (or at least makes it very inefficient).\nFor example, the bodies of RGBA.Opaque and NRGBA.Opaque are identical, so you'd think that they could be factored out into a third function with a signature something like this:\nfunc opaque(pix []Color, stride int, rect Rectangle) bool\n\nYou'd like to call that function this way:\nfunc (p *RGBA) Opaque() bool {\n    return opaque([]Color(p.Pix), p.Stride, p.Rect)\n}\n\nBut you can't. p.Pix can't be converted to []Color because those types have different in-memory representations and the spec forbids it. We could allocate a new slice, convert each individual element of p.Pix, and pass that, but that would be very inefficient.\nObserve that RGBAColor and NRGBAColor have the exact same structure. Maybe we could factor out the function for just those two types, since the in-memory representation of the pixel slices is exactly the same:\nfunc opaque(pix []RGBAColor, stride int, rect Rectangle) bool\n\nfunc (p *NRGBA) Opaque() bool {\n    return opaque([]RGBAColor(p.Pix), p.Stride, p.Rect)\n}\n\nAlas, again this isn't allowed. This seems to be more of a spec/language issue than a technical one. I'm sure this has come up on the mailing list before, but I can't find a good discussion of it.\nThis seems like an area where generics would come in handy, but there's no solution for generics in Go yet."}
{"instruction": "Answer the following programming question.", "input": "I have two goroutine like,\nRoutine 1 {\n// do something\n}\nRoutine 2 {\n // do something\n}\n main {\n // do something\n}\n\nIs it possible from in routine 1, if some condition met, stop whole program execution ? Stop  execution of main and Routine 2 ? Can give a simple example.", "output": "For example,\npackage main\n\nimport \"os\"\n\nfunc routine1() {\n    // set exit = true when ready to exit\n    exit := false\n    if exit {\n        os.Exit(0)\n    }\n}\n\nfunc routine2() {\n}\n\nfunc main() {\n    go routine1()\n    go routine2()\n}"}
{"instruction": "Answer the following programming question.", "input": "I want to create a Google Go application that will be able to DER encode and decode big integers (namely, ECDSA signature r and s). From what I understand I should use the asn1 package, but what functions should I be calling?\nFor example, I want to encode \n316eb3cad8b66fcf1494a6e6f9542c3555addbf337f04b62bf4758483fdc881d\n\nand\nbf46d26cef45d998a2cb5d2d0b8342d70973fa7c3c37ae72234696524b2bc812\n\nto get this:\n30450220316eb3cad8b66fcf1494a6e6f9542c3555addbf337f04b62bf4758483fdc881d022100bf46d26cef45d998a2cb5d2d0b8342d70973fa7c3c37ae72234696524b2bc81201\n\nand vice versa. Which function should I call for encoding, and which for decoding and how?", "output": "You need to encode an ASN.1 sequence containing both r and s integers as follows:\nECDSA-Sig-Value ::= SEQUENCE {\n  r INTEGER,\n  s INTEGER }\n\nPlease note that I am not a Go developer but according to the documentation Marshal and Unmarshal functions seems to accept structs in order to encode/decode ASN.1 sequences.\nThis code sample seems to work for both encoding and decoding:\npackage main\n\nimport (\n    \"fmt\"\n    \"big\"\n    \"asn1\"\n)\n\ntype ecdsa struct {\n    R, S *big.Int\n}\n\nfunc main() {\n    r, _ := new(big.Int).SetString(\"316eb3cad8b66fcf1494a6e6f9542c3555addbf337f04b62bf4758483fdc881d\", 16);\n    s, _ := new(big.Int).SetString(\"bf46d26cef45d998a2cb5d2d0b8342d70973fa7c3c37ae72234696524b2bc812\", 16);\n    sequence := ecdsa{r, s}\n    encoding, _ := asn1.Marshal(sequence)\n    fmt.Println(encoding)\n    dec := new(ecdsa)\n    asn1.Unmarshal(encoding, dec)\n    fmt.Println(dec)\n}"}
{"instruction": "Answer the following programming question.", "input": "Are there some Go libraries for sessions?\nUsing Python/Django there wasn't any problem.\nI am new to Go and I haven't found anything about it. So, are there general sessions support for Go? Are there some frameworks with sessions support? (It seems web.go has no sessions support, doesn't it?)", "output": "Gorilla's sessions package is the one I use and I guess the best choice for most projects. Gorilla also offers a lower-level package, securecookie.\nOther options include seshcookie and authcookie."}
{"instruction": "Answer the following programming question.", "input": "I'm writing some code that needs functionality that is almost satisfied by the ReadBytes method in the bufio package. Specifically, that method reads from a Reader until it encounters a particular byte. I need something that reads till it encounters one out of couple of bytes (space, newline and tab mainly).\nI looked at the source for the library and I know what to do if I have access to the internal buffer used by bufio structs. Is there any way I could \"monkey patch\" the package and add another method or two to it? Or another way to get the functionality I need?", "output": "Something along this approach (caution: untested code):\ntype reader struct{\n        *bufio.Reader // 'reader' inherits all bufio.Reader methods\n}\n\nfunc newReader(rd io.Reader) reader {\n        return reader{bufio.NewReader(rd)}\n}\n\n// Override bufio.Reader.ReadBytes\nfunc (r reader) ReadBytes(delim byte) (line []byte, err error) {\n        // here goes the monkey patch\n}\n\n// Or\n\n// Add a new method to bufio.Reader\nfunc (r reader) ReadBytesEx(delims []byte) (line []byte, err error) {\n        // here goes the new code\n}\n\nEDIT: I should have noted that this doesn't help to access the original package internals (non exported entities). Thanks Abhay for pointing that out in your comment."}
{"instruction": "Answer the following programming question.", "input": "I'm trying to create an XMPP library (and later a server) from scratch in Go (although the language itself is irrelevant) as a means to learn what I can about the XMPP protocol and server software development in general.\nAs many of you know, XMPP is messaging protocol based on XML that depends on an enormous amount of short but frequent XML streams. I'm thinking that for such applications an event based XML parser should be better because I won't need DOM and all that (correct me if I'm wrong). Please keep in mind that this library is intended for servers so there might be many instances run at once; \nWhich one of the two has better performance and memory usage for that use case, libxml2 or expat?", "output": "There is a whole project devoted to answering the question of XML performance called XML Benchmark.\nThe short answer, in my opinion, is to use libxml2, but I have other considerations beyond pure performance, such as platform availability. That said, it is generally faster than expat according to the latest numbers, though it's fairly close in the great scheme of things.\nAnd yes, you want to use the SAX parser, not the DOM parser."}
{"instruction": "Answer the following programming question.", "input": "How to create a new data type for Go which to can check/validate its schema when is created a new variable (of that type)?\nBy example, to validate if a string has 20 characters, I tried:\n// Format: 2006-01-12T06:06:06Z\nfunc date(str string) {\n  if len(str) != 20 {\n    fmt.Println(\"error\")\n  }\n}\nvar Date = date()\n\ntype Account struct {\n  domain  string\n  username string\n  created  Date\n}\n\nbut it fails because Date is not a type.", "output": "In your example, you defined Date as a variable and then tried to use it as a type.\nMy guess is that you want to do something like this.\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\ntype Date int64\n\ntype Account struct {\n    domain   string\n    username string\n    created  Date\n}\n\nfunc NewDate(date string) (Date, os.Error) {\n    // date format: 2006-01-12T06:06:06Z\n    if len(date) == 0 {\n        // default to today\n        today := time.UTC()\n        date = today.Format(time.ISO8601)\n    }\n    t, err := time.Parse(time.ISO8601, date)\n    if err != nil {\n        return 0, err\n    }\n    return Date(t.Seconds()), err\n}\n\nfunc (date Date) String() string {\n    t := time.SecondsToUTC(int64(date))\n    return t.Format(time.ISO8601)\n}\n\nfunc main() {\n    var account Account\n    date := \"2006-01-12T06:06:06Z\"\n    created, err := NewDate(date)\n    if err == nil {\n        account.created = created\n    } else {\n        fmt.Println(err.String())\n    }\n    fmt.Println(account.created)\n}"}
{"instruction": "Answer the following programming question.", "input": "Is it possible to make the garbage collector in Go handle and release memory allocated through C code? I apologize, I haven't used C and cgo before so my examples may need some clarification.\nLets say you've got some C library that you'd like to use and this library allocates some memory that needs to be freed manually. What I'd like to do is something like this:\npackage stuff\n\n/*\n#include <stuff.h>\n*/\nimport \"C\"\n\ntype Stuff C.Stuff\n\nfunc NewStuff() *Stuff {\n    stuff := Stuff(C.NewStuff()) // Allocate memory\n\n    // define the release function for the runtime to call\n    // when this object has no references to it (to release memory)   \n    // In this case it's stuff.Free()     \n\n    return stuff\n\n}\n\nfunc (s Stuff) Free() {\n    C.Free(C.Stuff(s)) // Release memory\n}\n\nIs there any way for the garbage collector to call Stuff.Free() when there are no references to *Stuff in the Go runtime? \nAm I making sense here?\nPerhaps a more direct question is: Is it possible to make the runtime automatically handle the cleanup of C allocated memory by writing a function that the runtime calls when there are zero references to that object?", "output": "There exists the runtime.SetFinalizer function, but it cannot be used on any object allocated by C code.\nHowever, you can create a Go object for each C object that needs to be freed automatically:\ntype Stuff struct {\n    cStuff *C.Stuff\n}\n\nfunc NewStuff() *Stuff {\n    s := &Stuff{C.NewStuff()}\n    runtime.SetFinalizer(s, (*Stuff).Free)\n    return s\n}\n\nfunc (s *Stuff) Free() {\n    C.Free(s.cStuff)\n}"}
{"instruction": "Answer the following programming question.", "input": "I noticed that garbage collection is not yet implemented in gccgo.\nhttp://golang.org/doc/gccgo_install.html#Unimplemented\nDoes the standard Go compiler (gc) support garbage collection yet?", "output": "gccgo has its own runtime, the plan is to switch to use a single runtime shared by both gc and gccgo.\nAlso, the current garbage collector in gc is rather simple, a concurrent and much faster implementation based on research done by IBM is under development, and will probably be the one used by both gccgo and gc."}
{"instruction": "Answer the following programming question.", "input": "I have a string with name of package (like \"my/package/test\") and I wanna import that and call some function from package.\nSomething like this:\nfunc init() {\n  var pkg string = \"test/my/pkg\"\n  import pkg\n  pkg.Test()\n}\n\nPS. Thanks for help", "output": "The Go language does not allow what you mentioned in your example. This is a conscious choice. In my opinion, the reason behind this choice has to do with compiler performance and ease of code understanding by the machine. This for example enables tools such as gofix that can partially fix Go code without need for user intervention.\nIt also enables a programmer to clearly see all of the statically imported packages used by the program.\nSee also the grammar rules for source file organization in the Go language specification.\n\nIn relation to dynamically loading packages at run-time: Go has no support for loading packages at run-time. A future Go run-time might implement this feature (for example, it is occasionally being requested in messages in the golang-nuts mailing list), but the current state is that there is no support for this feature."}
{"instruction": "Answer the following programming question.", "input": "My apologies if this is a beginner question, but I simply can't seem to find any solution for this. I'm trying to take an argument that can be either a string or an int, depending on the context, and I need to determine which type, (then convert it to int if it is indeed that type.)\nThank you :)", "output": "http://golang.org/pkg/strconv/#Atoi\nfunc Atoi\n\nfunc Atoi(s string) (i int, err error)\nAtoi is shorthand for ParseInt(s, 10, 0).\n\nThis is an update. To clarify, since Atoi accepts string, then trying to pass an int will cause a compile time error. If you need a check during runtime, then you can do something like this.\npackage main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"errors\"\n)\n\nfunc toInt(data interface{}) (n int, err error) {\n    switch t := data.(type) {\n    case int:\n        return t, nil\n    case string:\n        return strconv.Atoi(t)\n    default:\n        return 0, errors.New(fmt.Sprintf(\"Invalid type received: %T\", t))\n    }\n\n    panic(\"unreachable!\")\n}\n\nfunc main() {\n    var (\n        n int\n        err error\n    )\n\n    n, _ = toInt(\"1\")\n    fmt.Println(n)\n\n    n, _ = toInt(2)\n    fmt.Println(n)\n\n    n, err = toInt(32.3)\n    fmt.Println(err)\n}"}
{"instruction": "Answer the following programming question.", "input": "Go is a garbage collected language:\nhttp://golang.org/doc/go_faq.html#garbage_collection\nHere it says that it's a mark-and-sweep garbage collector, but it doesn't delve into details, and a replacement is in the works... yet, this paragraph seems not to have been updated much since Go was released.\nIt's still mark-and-sweep? Is it conservative or precise? Is it generational?", "output": "Plans for Go 1.4+ garbage collector:\n\nhybrid stop-the-world/concurrent collector\nstop-the-world part limited by a 10ms deadline\nCPU cores dedicated to running the concurrent collector\ntri-color mark-and-sweep algorithm\nnon-generational\nnon-compacting\nfully precise\nincurs a small cost if the program is moving pointers around\nlower latency, but most likely also lower throughput, than Go 1.3 GC\n\nGo 1.3 garbage collector updates on top of Go 1.1:\n\nconcurrent sweep (results in smaller pause times)\nfully precise\n\nGo 1.1 garbage collector:\n\nmark-and-sweep (parallel implementation)\nnon-generational\nnon-compacting\nmostly precise (except stack frames)\nstop-the-world\nbitmap-based representation\nzero-cost when the program is not allocating memory (that is: shuffling pointers around is as fast as in C, although in practice this runs somewhat slower than C because the Go compiler is not as advanced as C compilers such as GCC)\nsupports finalizers on objects\nthere is no support for weak references\n\nGo 1.0 garbage collector:\n\nsame as Go 1.1, but instead of being mostly precise the garbage collector is conservative. The conservative GC is able to ignore objects such as []byte.\n\nReplacing the GC with a different one is controversial, for example:\n\nexcept for very large heaps, it is unclear whether a generational GC would be faster overall\npackage \"unsafe\" makes it hard to implement fully precise GC and compacting GC"}
{"instruction": "Answer the following programming question.", "input": "When following instructions on Getting Started - The Go Programming Language, I get the code and try to run the all.bash script.\nBut I get this error after a lot of other successful looking output:\nINSTALL FAIL net\nCGOPKGPATH= cgo --  cgo_bsd.go cgo_unix.go \ntouch _obj/_cgo_run\n6g  -o _go_.6 dial.go dnsmsg.go fd_darwin.go hosts.go ip.go ipsock.go iprawsock.go lookup.go net.go parse.go pipe.go sock.go tcpsock.go udpsock.go unixsock.go  newpollserver.go fd.go file.go dnsconfig.go dnsclient.go port.go  _obj/cgo_bsd.cgo1.go _obj/cgo_unix.cgo1.go _obj/_cgo_gotypes.go\n6c -FVw -I/Users/matryer/Work/go/pkg/darwin_amd64 -I . -o \"_cgo_defun.6\" _obj/_cgo_defun.c\ngcc -m64 -I . -g -fPIC -O2 -o _cgo_main.o -c   _obj/_cgo_main.c\ngcc -m64 -I . -g -fPIC -O2 -o cgo_bsd.cgo2.o -c   _obj/cgo_bsd.cgo2.c\ngcc -m64 -I . -g -fPIC -O2 -o cgo_unix.cgo2.o -c   _obj/cgo_unix.cgo2.c\ngcc -m64 -I . -g -fPIC -O2 -o _cgo_export.o -c   _obj/_cgo_export.c\ngcc -m64 -g -fPIC -O2 -o _cgo1_.o _cgo_main.o cgo_bsd.cgo2.o cgo_unix.cgo2.o _cgo_export.o  \ncgo -dynimport _cgo1_.o >_obj/_cgo_import.c_ && mv -f _obj/_cgo_import.c_ _obj/_cgo_import.c\n6c -FVw -I . -o \"_cgo_import.6\" _obj/_cgo_import.c\ncgo_bsd.go:5[_obj/cgo_bsd.cgo1.go:8]: undefined: _Cconst_AI_MASK\ncgo_unix.go:69[_obj/cgo_unix.cgo1.go:72]: undefined: _Cconst_AI_ALL\ncgo_unix.go:69[_obj/cgo_unix.cgo1.go:72]: undefined: _Cconst_AI_V4MAPPED\ncgo_unix.go:69[_obj/cgo_unix.cgo1.go:72]: undefined: _Cconst_AI_CANONNAME\nmake[1]: *** [_go_.6] Error 1\nmake: *** [net.install] Error 1\n\nHas anybody else seen this and fixed it?\nI am running Snow Leopard (10.6.7) build 10J869.", "output": "It's an open issue, relating to a new version of Xcode, for OS X 10.7 and 10.6.7.\nIssue 1881: cgo const error on OS X 10.7\nNOTE: Revision 142f0bc0d6e7 has been made to close issue 1881. To update Go for all changes up to and including this revision, run:\n$ cd $GOROOT/src\n$ hg pull\n$ hg update 142f0bc0d6e7\n$ ./all.bash"}
{"instruction": "Answer the following programming question.", "input": "I can't seem to find any... it's a bit sad for a language positioned as networking-oriented one.", "output": "After sometime in exp/ssh, the official ssh package now resides in the crypto/ssh subrepo: http://code.google.com/p/go/source/browse?repo=crypto#hg%2Fssh"}
{"instruction": "Answer the following programming question.", "input": "Has anyone created a vim syntax file for the go language?", "output": "go.vim\nThere is also a syntax file on vim.org."}
{"instruction": "Answer the following programming question.", "input": "All the examples I've seen so far involve blocking to get the result (via the <-chan operator).\nMy current approach involves passing a pointer to a struct:\ntype goresult struct {\n    result resultType;\n    finished bool;\n}\n\nwhich the goroutine writes upon completion. Then it's a simple matter of checking finished whenever convenient. Do you have better alternatives?\nWhat I'm really aiming for is a Qt-style signal-slot system. I have a hunch the solution will look almost trivial (chans have lots of unexplored potential), but I'm not yet familiar enough with the language to figure it out.", "output": "You can use the \"comma, ok\" pattern (see their page on \"effective go\"):\nfoo     := <- ch; // This blocks.\nfoo, ok := <- ch; // This returns immediately."}
{"instruction": "Answer the following programming question.", "input": "Is there any program to automatically convert Go source code to Python source code?", "output": "It's highly unlikely that you'll find a way to do such a conversion with output that is actually useful. Go is very new, and if anything it would make more sense for someone to convert the other way around."}
{"instruction": "Answer the following programming question.", "input": "I want to open a web browser:\nc, err := exec.Command(\"http://localhost:4001\").Output()\nif err != nil {\n    fmt.Printf(\"ERROR: %v, %v\\n\",err,c)\n} else {\n    fmt.Printf(\"OK:%v\\n\",c)\n}\n\nand I get the error \nERROR: exec: \"http://localhost:4001\": file does not exist\n\nEdit: What I want to achieve is the same as in Windows and C# when you do: \nProcess.Start(\"http://localhost:4001\")\n\nWith it a new instance of your default browser will launch showing the URL", "output": "\"http://localhost:4001/\" is a URL, it can not be executed, but you can execute a web browser (e.g. firefox) and pass the URL as first argument.\nOn Windows, OS X, and Linux helper programs exist which can be used to start the default web browser. I guess there is a similar thing for FreeBSD and Android, but I am not sure about it. The following snippet should work on Windows, OS X, and most Linux distros:\nvar err error\nswitch runtime.GOOS {\ncase \"linux\":\n    err = exec.Command(\"xdg-open\", \"http://localhost:4001/\").Start()\ncase \"windows\", \"darwin\":\n    err = exec.Command(\"open\", \"http://localhost:4001/\").Start()\ndefault:\n    err = fmt.Errorf(\"unsupported platform\")\n}"}
{"instruction": "Answer the following programming question.", "input": "I'm trying to understand the Go language. I tried to create two goroutines\nthat chain the flow between them using two channels:\nfunc main() {\nc1 := make(chan int)\nc2 := make(chan int)\n\ngo func() {\n    for i := range c1{\n        println(\"G1 got\", i)\n        c2 <- i\n    }\n}()\n\ngo func() {\n    for i := range c2 {\n        println(\"G2 got\", i)\n        c1 <- i\n    }\n}()\n\n\nc1 <- 1\n\ntime.Sleep(1000000000 * 50)\n}\n\nAs expected this code prints:\n G1 got 1\n G2 got 1\n G1 got 1\n G2 got 1\n ....\n\nUntil the main function exits.\nBut if I send another value to one of the channels from main, it suddenly blocks:\nfunc main() {\nc1 := make(chan int)\nc2 := make(chan int)\n\ngo func() {\n    for i := range c1{\n        println(\"G1 got\", i)\n        c2 <- i\n    }\n}()\n\ngo func() {\n    for i := range c2 {\n        println(\"G2 got\", i)\n        c1 <- i\n    }\n}()\n\n\nc1 <- 1\n\ntime.Sleep(1000000000 * 1)\n\nc1 <- 2\n\ntime.Sleep(1000000000 * 50)\n}\n\nIt outputs \nG1 got 1\nG2 got 1\nG1 got 1\nG2 got 1\nG1 got 2\n\nand then blocks until the main ends.\nThe value \"2\" sent to c1 arrives to the first goroutie, which sends it to c2, but the second\ngoroutine never receives.\n(Using buffered channels with size 1 (either c1 or c2) works in this example)\nWhy does it happen? When this happens in real code, how can I debug it?", "output": "Go channels created with make(chan int) are not buffered. If you want a buffered channel (that won't necessarily block), make it with make(chan int, 2) where 2 is the size of the channel.\nThe thing about unbuffered channels is that they are also synchronous, so they always block on write as well as read.\nThe reason it deadlocks is that your first goroutine is waiting for its c2 <- i to finish while the second one is waiting for c1 <- i to finish, because there was an extra thing in c1. The best way I've found to debug this sort of thing when it happens in real code is to look at what goroutines are blocked and think hard.\nYou can also sidestep the problem by only using synchronous channels if they're really needed."}
{"instruction": "Answer the following programming question.", "input": "Is there a library to generate QR Codes with the Go programming language? I'm looking for something in pure Go that generates image files.", "output": "Russ has done some funny things with QR codes and his tool\nis available here:\nhttp://code.google.com/p/rsc/source/browse/qr"}
{"instruction": "Answer the following programming question.", "input": "I was reading about Go, and I can see that it's very good and can be a language used by many developers in some months, but I want to decide a simple thing: Learn Go or improve my Python or Ruby knowledge?\nYears developing with Python: 1\nYears developing with Ruby: 0.3", "output": "If you're just looking to have fun and expand your horizons, then I'd learn Go, since you already know some Python.\nIf you're looking to improve as a developer, I'd personally recommend working on an actual project (using Python, as it's the language you have the most experience with):\n\nThis will take your (Python and general) programming skills to a whole new level\nIf you choose an interesting project, for example a semi-popular open source project, you'll even have some concrete result to show for your extra work. This will help your resume, help you meet other people interested in programming, etc.\n\nI personally believe that spending the time you would have spent learning a new language by coding actual things you can use, is usually a net win (unless of course, like I said, you're just doing it for some fun recreation or relaxation)."}
{"instruction": "Answer the following programming question.", "input": "I'm currently following this tutorial http://www.miek.nl/files/go/20120807-go.pdf and on chapter 7 it discusses channels/goroutines\nHowever the example code is throwing an error for me just after you run it.\npackage main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nvar c chan int\n\nfunc ready(w string, sec int) {\n    time.Sleep(time.Duration(sec) * time.Second)\n    fmt.Println(w, \"is ready!\")\n    c <- 1\n}\n\nfunc main() {\n    c := make(chan int)\n    go ready(\"Tea\", 2)\n    go ready(\"Coffee\", 1)\n    fmt.Println(\"Waiting...\")\n    <-c\n    <-c\n}\n\nHere is the output when you execute the code\ndaniel:go> go run goroutines.go \nWaiting...\nCoffee is ready!\nTea is ready!\nthrow: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan receive]:\nmain.main()\n    /home/daniel/Dropbox/code/go/goroutines.go:21 +0xee\n\ngoroutine 2 [syscall]:\ncreated by runtime.main\n    /build/buildd/golang-1/src/pkg/runtime/proc.c:221\n\ngoroutine 3 [chan send (nil chan)]:\nmain.ready(0x80bb0d4, 0x3, 0x2, 0x0)\n    /home/daniel/Dropbox/code/go/goroutines.go:13 +0xe5\ncreated by main.main\n    /home/daniel/Dropbox/code/go/goroutines.go:18 +0x5e\n\ngoroutine 4 [chan send (nil chan)]:\nmain.ready(0x80bba30, 0x6, 0x1, 0x0)\n    /home/daniel/Dropbox/code/go/goroutines.go:13 +0xe5\ncreated by main.main\n    /home/daniel/Dropbox/code/go/goroutines.go:19 +0x80\n\ngoroutine 5 [timer goroutine (idle)]:\ncreated by addtimer\n    /build/buildd/golang-1/src/pkg/runtime/ztime_386.c:69\nexit status 2\n\nIs there something wrong with my code? \nAny help would be appreciated", "output": "Yes, just a typo:\npackage main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nvar c chan int\n\nfunc ready(w string, sec int) {\n    time.Sleep(time.Duration(sec) * time.Second)\n    fmt.Println(w, \"is ready!\")\n    c <- 1\n}\n\nfunc main() {\n    c = make(chan int) // previously c := make(chan int)\n    go ready(\"Tea\", 2)\n    go ready(\"Coffee\", 1)\n    fmt.Println(\"Waiting...\")\n    <-c\n    <-c\n}\n\nmain() didn't use the global c since it declared a new one.\nNotice that you don't have to make the channel inside main(), make it while declaring it:\nvar c = make(chan int)"}
{"instruction": "Answer the following programming question.", "input": "How can I encode my string as ASCII byte array?", "output": "If you're looking for a conversion, just do byteArray := []byte(myString)\nThe language spec details conversions between strings and certain types of arrays (byte for bytes, int for Unicode points)"}
{"instruction": "Answer the following programming question.", "input": "I am trying to get started with Go and the documentation is very good. What I did not find in the documentation is the difference between functions and methods.\nAs far as I understand at the moment: functions are \"global\", which means I do not have to import a package to use functions, they are always there. Methods are bound to packages. Is this correct?", "output": "As far as I understand at the moment: functions are \"global\", which means I do not have to import a package to use functions, they are always there. Methods are bound to packages. Is this correct?\n\nNo, that's not correct. There are just a couple of functions from the builtin package which are always available. Everything else needs to be imported.\nThe term \"method\" came up with object-oriented programming. In an OOP language (like C++ for example) you can define a \"class\" which encapsulates data and functions which belong together. Those functions inside a class are called \"methods\" and you need an instance of that class to call such a method.\nIn Go, the terminology is basically the same, although Go isn't an OOP language in the classical meaning. In Go, a function which takes a receiver is usually called a method (probably just because people are still used to the terminology of OOP).\nSo, for example:\nfunc MyFunction(a, b int) int {\n  return a + b\n}\n// Usage:\n// MyFunction(1, 2)\n\nbut\ntype MyInteger int\nfunc (a MyInteger) MyMethod(b int) int {\n  return a + b\n}\n// Usage:\n// var x MyInteger = 1\n// x.MyMethod(2)"}
{"instruction": "Answer the following programming question.", "input": "Given\nvar dst, src map[K]V\n\nI can copy all entries from src into dst by doing\nfor k, v := range src {\n    dst[k] = v\n}\n\nIs there a more idiomatic way to do this?\ncopy only works on slices (and string as a source).", "output": "That looks like a perfectly fine way to do this to me. I don't think copying one map into another is common enough to have a one-liner solution."}
{"instruction": "Answer the following programming question.", "input": "I'm trying to learn the go language, and I'm writing a simple echo server. I'm having difficulty making it work, though.\nfunc listen(server string) {\n    var buf []byte\n\n    listener, ok := net.Listen(\"tcp\", server)\n    if ok != nil {\n        fmt.Fprintf(os.Stderr, \"Could not listen on socket: %s\\n\", ok.String())\n        return\n    }\n    conn, ok := listener.Accept()\n    if ok != nil {\n        fmt.Fprintf(os.Stderr, \"Could not accept connection on socket: %s\\n\", ok.String())\n        return\n    }\n\n    writelen, ok := conn.Write(strings.Bytes(\"Ready to receive\\n\"))\n    if ok != nil {\n        fmt.Fprintf(os.Stderr, \"Could not write to socket: %s\\n\", ok.String())\n    } else {\n        fmt.Printf(\"Wrote %d bytes to socket\\n\", writelen)\n    }\n\n    for ;; {\n        readlen, ok := conn.Read(buf)\n        if ok != nil {\n            fmt.Fprintf(os.Stderr, \"Error when reading from socket: %s\\n\", ok.String())\n            return\n        }\n        if readlen == 0 {\n            fmt.Printf(\"Connection closed by remote host\\n\")\n            return\n        }\n\n        fmt.Printf(\"Client at %s says '%s'\\n\", conn.RemoteAddr().String(), buf)\n    }\n}\n\nI get the following output from this function:\n[nathan@ebisu ~/src/go/echo_server] ./6.out 1234\nUsing port 1234\nWrote 17 bytes to socket\nError when reading from socket: EOF\n\nThis is what I see on the client:\n[nathan@ebisu ~] telnet 127.0.0.1 1234\nTrying 127.0.0.1...\nConnected to 127.0.0.1.\nEscape character is '^]'.\nReady to receive\nConnection closed by foreign host.\n\nAny help would be appreciated (or pointers to resources; the go documentation on the sockets API leaves a little to be desired).\nThanks,\nNathan", "output": "In your example, buf needs to have a definite size. You've declared it as a 0-length slice. \nDeclare it as:\nvar buf = make([]byte, 1024)"}
{"instruction": "Answer the following programming question.", "input": "For some reason when I attempt to store boolean data in the Google Apps datastore, it always stores as false.\nMy entity definition looks like this:\ntype Link struct {\n  Name          string    //Coloquial label for link. Set by original User.\n  ...\n  isOpen        bool      //Tells us whether anyone can rewrite the link. Set by original User.\n  isPerminant   bool      //Tells us whether link should be saved forever.\n  isFlagged     bool      //Tells us whether the content has ever been flagged inappropriate.\n}\n\nI create an object and assign values like so:\n//Create Link from form data\nl   := Link{\n  Name:         r.FormValue(\"name\"),\n  ...\n  isOpen:       r.FormValue(\"open\")==\"on\",        \n  isPerminant:  r.FormValue(\"perminant\")==\"on\",\n  isFlagged:    r.FormValue(\"flagged\")==\"on\",\n}\n\nI verify the data by running the following:\n//Put the Link in the datastore\nlKey, err := datastore.Put(c, datastore.NewIncompleteKey(c, \"Link\", nil), &l)\nif err != nil {\n  http.Error(w, err.Error(), http.StatusInternalServerError)\n  return\n}\n\nvar newLink Link\nif err = datastore.Get(c, lKey, &newLink); err != nil {\n  http.Error(w, err.Error(), http.StatusInternalServerError)\n  return\n}\n\nnewLink output value: {[name] ... false false false}\n\nEven if I hard code in a true value for one of the is[...] properties, they all still remain false! WHHHHHHYYYY???", "output": "Try capitalizing the I in Is:\ntype Link struct {\n    Name        string //Coloquial label for link. Set by original User.\n    IsOpen      bool   //Tells us whether anyone can rewrite the link. Set by original User.\n    IsPerminant bool   //Tells us whether link should be saved forever.\n    IsFlagged   bool   //Tells us whether the content has ever been flagged inappropriate.\n}\n\n.\n//Create Link from form data\nl := Link{\n    Name:        r.FormValue(\"name\"),\n    IsOpen:      r.FormValue(\"open\") == \"on\",\n    IsPerminant: r.FormValue(\"perminant\") == \"on\",\n    IsFlagged:   r.FormValue(\"flagged\") == \"on\",\n}\n\nFor a field to be saved to the datastore it must be exported. I.e. begin with an uppercase letter. For more information please read the Names section of Effective Go"}
{"instruction": "Answer the following programming question.", "input": "I have a webapp where I have code like:\nfunc handler (w res, r req) {\n  if req.Method == POST {\n    // create html form 2 with a submit button2\n    return ;\n  }\n  // create html form 1 with a submit button1\n  return\n} \n\nfunc main() {\n  handle(\"/\", handler)\n}\n\nNow, the root / is registered with the handler func. In the first request (GET), I create a form and send it to the user. If the user submits this form, I handle it under the \"POST\" method. Now, I create a different form in the post method handler, and now I want a way to do some operations based on what the user typed in this form2, when [s]he submits form2.\nWhat is the standard way with go to handle the form2 form submission ? I have done some asp programming earlier and we use form action to submit to a different asp file. How can I do some actions based on parsing the form2 submission request ?", "output": "If I'm understanding you correctly, you want a way of routing the same URL to different handlers based on the request method rather than just the path? If that's the case...\nFor comparison, using Python + Django, the way you're doing this is pretty standard:\ndef my_django_view(request):\n    if request.method == \"POST\":\n        try_to_process_posted_data()\n    elif request.method == \"GET\":\n        show_a_form_to_user()\n\nIf you are trying to do fancier things like URL routing based on path and request method (GET, POST, DELETE, ...), then you might be interested in something like Gorilla.mux\nIt provides some friendly URL routing methods:\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/\", YourGETHandlerFunc).Methods(\"GET\")\n    router.HandleFunc(\"/\", YourPOSTHandlerFunc).Methods(\"POST\")\n    http.Handle(\"/\", router)\n}\n\nIf you're looking for more resources for web development...\n\nMango: http://paulbellamy.com/2011/05/introducing-mango/\nWeb.go: http://www.getwebgo.com/tutorial\nTwister: https://github.com/garyburd/twister/blob/master/examples/hello/main.go"}
{"instruction": "Answer the following programming question.", "input": "I'm using go language and it seems good practice to communicate between different threads/routines by channels and locks instead of datastore. However, it appears that it's not possible between two instances if there's more than one instance running. Is there a way to make it not open a second one, even if there's high traffic?", "output": "You should use Backends if you want fine to control the spawning and shutdown of instances."}
{"instruction": "Answer the following programming question.", "input": "How many goroutines can I use painless? For example wikipedia says, in Erlang 20 million processes can be created without degrading performance.\nUpdate: I've just investigated in goroutines performance a little and got such a results:\n\nIt looks like goroutine lifetime is more then calculating sqrt() 1000 times ( ~45µs for me ), the only limitation is memory\nGoroutine costs 4 — 4.5 KB", "output": "If a goroutine is blocked, there is no cost involved other than:\n\nmemory usage\nslower garbage-collection\n\nThe costs (in terms of memory and average time to actually start executing a goroutine) are:\nGo 1.6.2 (April 2016)\n  32-bit x86 CPU (A10-7850K 4GHz)\n    | Number of goroutines: 100000\n    | Per goroutine:\n    |   Memory: 4536.84 bytes\n    |   Time:   1.634248 µs\n  64-bit x86 CPU (A10-7850K 4GHz)\n    | Number of goroutines: 100000\n    | Per goroutine:\n    |   Memory: 4707.92 bytes\n    |   Time:   1.842097 µs\n\nGo release.r60.3 (December 2011)\n  32-bit x86 CPU (1.6 GHz)\n    | Number of goroutines: 100000\n    | Per goroutine:\n    |   Memory: 4243.45 bytes\n    |   Time:   5.815950 µs\n\nOn a machine with 4 GB of memory installed, this limits the maximum number of goroutines to slightly less than 1 million.\n\nSource code (no need to read this if you already understand the numbers printed above):\npackage main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"os\"\n    \"runtime\"\n    \"time\"\n)\n\nvar n = flag.Int(\"n\", 1e5, \"Number of goroutines to create\")\n\nvar ch = make(chan byte)\nvar counter = 0\n\nfunc f() {\n    counter++\n    <-ch // Block this goroutine\n}\n\nfunc main() {\n    flag.Parse()\n    if *n <= 0 {\n            fmt.Fprintf(os.Stderr, \"invalid number of goroutines\")\n            os.Exit(1)\n    }\n\n    // Limit the number of spare OS threads to just 1\n    runtime.GOMAXPROCS(1)\n\n    // Make a copy of MemStats\n    var m0 runtime.MemStats\n    runtime.ReadMemStats(&m0)\n\n    t0 := time.Now().UnixNano()\n    for i := 0; i < *n; i++ {\n            go f()\n    }\n    runtime.Gosched()\n    t1 := time.Now().UnixNano()\n    runtime.GC()\n\n    // Make a copy of MemStats\n    var m1 runtime.MemStats\n    runtime.ReadMemStats(&m1)\n\n    if counter != *n {\n            fmt.Fprintf(os.Stderr, \"failed to begin execution of all goroutines\")\n            os.Exit(1)\n    }\n\n    fmt.Printf(\"Number of goroutines: %d\\n\", *n)\n    fmt.Printf(\"Per goroutine:\\n\")\n    fmt.Printf(\"  Memory: %.2f bytes\\n\", float64(m1.Sys-m0.Sys)/float64(*n))\n    fmt.Printf(\"  Time:   %f µs\\n\", float64(t1-t0)/float64(*n)/1e3)\n}"}
{"instruction": "Answer the following programming question.", "input": "I'm bulding a small photo gallery website and I need a function that detect duplicate images (don't need to be be 100% accurate, just like Google Image Search).  \nI'm using a very new language (Golang) so I don't think there is any available library for this out there.  \nSo what is the starting point for me? Please give me some keyword about this. Or if you have any material that is simple and easy to understand, please share me.", "output": "I think this blog post is simple and easy to understand."}
{"instruction": "Answer the following programming question.", "input": "I have installed Go from gomingw for windows 64 bit. However, I cannot find out anywhere how to actually compile a .go file. This is the program linked directly from the Go wiki for Windows Support, but all the tutorials talk about using 6g and gccgo etc. and none of those work on my windows machine. Actually, what I am trying to do is, I put my \"hello.go\" in src folder and after going to src folder I run the command \"8g hello.go\" in command prompt. But. it showing error \"open a.go no such file or directory\". Can anybody help me by providing correct steps to compile a go program in Windows? Thanks in advance.", "output": "Navigate to your source code directory (for example, C:\\Arpsss), display the current directory, and display the current directory contents.\nC:\\>cd C:\\Arpssss\nC:\\Arpssss>cd\nC:\\Arpssss\nC:\\Arpssss>dir\n Volume in drive C has no label.\n Directory of C:\\Arpssss\n11/28/2011  10:26 AM    <DIR>          .\n11/28/2011  10:26 AM    <DIR>          ..\n11/28/2011  10:24 AM                73 hello.go\n               1 File(s)             73 bytes\n               2 Dir(s)   4,949,831,680 bytes free\n\nTry to compile a non-existent file named a.go.\nC:\\Arpssss>8g a.go\nopen a.go: No such file or directory\n\nThis is the error you reported--you tried to compile a file named a.go that wasn't in your current directory.\nCompile, link, and run the hello.go Go source file in the current directory.\nC:\\Arpssss>8g hello.go\nC:\\Arpssss>8l -o hello.exe hello.8\nC:\\Arpssss>hello\nHello, World!\n\nThe hello.go program.\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello, World!\")\n}"}
{"instruction": "Answer the following programming question.", "input": "I'm writing a function that returns a sequence of numbers of variable length:\nfunc fib(n int) ??? {\n    retval := ???\n    a, b := 0, 1\n    for ; n > 0; n-- {\n        ??? // append a onto retval here\n        c := a + b\n        a = b\n        b = c\n    }\n}\n\nIt can be observed that the final length of the returned sequence will be n. How and what should fib return to achieve idiomatic Go? If the length was not known in advance, how would the return value, and usage differ? How do I insert values into retval?", "output": "Here, we know how many numbers; we want n Fibonacci numbers.\npackage main\n\nimport \"fmt\"\n\nfunc fib(n int) (f []int) {\n    if n < 0 {\n        n = 0\n    }\n    f = make([]int, n)\n    a, b := 0, 1\n    for i := 0; i < len(f); i++ {\n        f[i] = a\n        a, b = b, a+b\n    }\n    return\n}\n\nfunc main() {\n    f := fib(7)\n    fmt.Println(len(f), f)\n}\n\nOutput: 7 [0 1 1 2 3 5 8]\n\nHere, we don't know how many numbers; we want all the Fibonacci numbers less than or equal to n.\npackage main\n\nimport \"fmt\"\n\nfunc fibMax(n int) (f []int) {\n    a, b := 0, 1\n    for a <= n {\n        f = append(f, a)\n        a, b = b, a+b\n    }\n    return\n}\n\nfunc main() {\n    f := fibMax(42)\n    fmt.Println(len(f), f)\n}\n\nOutput: 10 [0 1 1 2 3 5 8 13 21 34]\n\nYou could also use IntVector from the Go vector package. Note that type IntVector []int."}
{"instruction": "Answer the following programming question.", "input": "I've been developing a couple apps using Google App Engine Go SDK that use Memcache as a buffer for loading data from the Datastore. As the Memcache is only able to store data as []byte, I often find myself creating functions to encode the various structures as strings, and also functions to reverse the process. Needless to say, it is quite tedious when I need to do this sort of thing 5 times over.\nIs there an easy way to convert any arbitrary structure that can be stored in Datastore into []byte in order to store it in Memcache and then load it back without having to create custom code for various structures in GAE Golang?", "output": "http://golang.org/pkg/encoding/gob or http://golang.org/pkg/encoding/json can turn arbitrary datatypes into []byte slices given certain rules apply to the datastructures being encoded. You probably want one of them gob will encode to smaller sizes but json is more easily shareable with other languages if that is a requirement."}
{"instruction": "Answer the following programming question.", "input": "I have found a function call MethodByName() here http://golang.org/pkg/reflect/#Value.MethodByName but it's not exactly what I want! (maybe because I don't know how to use it ... I cannot find any example with it). What I want is:\ntype MyStruct struct {\n//some feilds here\n} \nfunc (p *MyStruct) MyMethod { \n    println(\"My statement.\"); \n} \n\nCallFunc(\"MyStruct\", \"MyMethod\"); \n//print out \"My statement.\" \n\nSo I guess, first I need something like StructByName() and after that use it for MethodByName(), is that right!?", "output": "To call a method on an object, first use reflect.ValueOf. Then find the method by name, and then finally call the found method. For example:\npackage main\n\nimport \"fmt\"\nimport \"reflect\"\n\ntype T struct {}\n\nfunc (t *T) Foo() {\n    fmt.Println(\"foo\")\n}\n\nfunc main() {\n    var t T\n    reflect.ValueOf(&t).MethodByName(\"Foo\").Call([]reflect.Value{})\n}"}
{"instruction": "Answer the following programming question.", "input": "I'm working on a very simple web app, written in Go language.\nI have a standalone version and now port it to GAE. It seems like there is very small changes, mainly concerning datastore API (in the standalone version I need just files).\nI also need to include appengine packages and use init() instead of main().\nIs there any simple way to merge both versions? As there is no preprocessor in Go, it seems like I must write a GAE-compatible API for the standalone version and use this mock module for standalone build and use real API for GAE version. But it sounds like an overkill to me.\nAnother problem is that GAE might be using older Go version (e.g. now recent Go release uses new template package, but GAE uses older one, and they are incompatible). So, is there any change to handle such differences at build time or on runtime?\nThanks,\nSerge\nUPD: Now GAE uses the same Go version (r60), as the stable standalone compiler, so the abstraction level is really simple now.", "output": "In broad terms, use abstraction. Provide interfaces for persistence, and write two implementations for that, one based on the datastore, and one based on local files. Then, write a separate main/init module for each platform, which instantiates the appropriate persistence interface, and passes it to your main application to use."}
{"instruction": "Answer the following programming question.", "input": "This is my code:\npackage main\nimport (\n    \"strconv\"\n    \"fmt\"\n)\nfunc main() {\n    t := strconv.Itoa64(1234)\n    fmt.Println(t)\n}\n\nProblem:\nWhy does it cause the following error message?\n\ncommand-line-arguments .\\test.go:7: undefined: strconv.Itoa64\n  [Finished in 0.2s with exit code 2]", "output": "This is because Itoa64 is not the name of a function in the strconv package. It looks like you really want.\nt := strconv.FormatInt(1234, 10)\n\nSee http://golang.org/pkg/strconv/#FormatInt"}
{"instruction": "Answer the following programming question.", "input": "I've been reviewing the contributions documentation for Google new language, and was curious about the idea of contributing a new package.  It states that this should be included at the top of contributed source code:\n// Copyright 2009 The Go Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style\n// license that can be found in the LICENSE file.\n\nMy understanding of a BSD-style license is that it essentially means that the user needs to attribute the code to you, but can do whatever else they want.\nFurther down it says: \n\nIf you are the copyright holder, you will need to agree to the individual contributor license agreement...\n\nIn the \"individual contributor license agreement\", it says that Google has patentable rights to the contributed code:\n\nYou hereby grant to Google and to recipients of software distributed by Google a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable (except as stated in this section) patent license to make, have made, use, offer to sell, sell, import, and otherwise transfer the Work, where such license applies only to those patent claims licensable by You that are necessarily infringed by Your Contribution(s) alone or by combination of Your Contribution(s) with the Work to which such Contribution(s) was submitted.\n\nTo what extent does Google own any Go contributions?  Do they have full rights to profit from these contributions?", "output": "To what extent does Google own any Go contributions?\n\nYou are not required to transfer copyright to Google.  You still OWN the copyright.\nYou are not required to transfer ownership of patents to Google.  You still OWN the patents.\nIn short Google does not OWN any IP that they didn't already own.\nBut you do grant Google the unlimited right to use and distribute your contributions, and you grant the right to use to downstream folks.  Clause 2 covers copyrights, and clause 3 covers patent rights.  Moreover you grant this as an irrevocable license (i.e. you cannot change your mind) and for free.\n\nDo they have full rights to profit\n  from these contributions?\n\nThere is no such a thing as \"a right to profit\" in a legal or moral sense.  Hence \"full rights to profit\" is not a valid characterization of the rights that you currently have.\nBy granting Google non-exclusive, non-revocable copyright and patent licenses, your remaining rights are no longer exclusive.  Google will be able to profit your contributions, but so will you.  You will have reduced your scope for personal profit, but that was not ever a \"right\"."}
{"instruction": "Answer the following programming question.", "input": "I'm new to Go, and I'm experiencing a bit of cognitive dissonance between C-style stack-based programming, where automatic variables live on the stack and allocated memory lives on the heap, and Python-style stack-based-programming, where the only thing that lives on the stack are references/pointers to objects on the heap.\nAs far as I can tell, the two following functions give the same output:\nfunc myFunction() (*MyStructType, error) {\n    var chunk *MyStructType = new(HeaderChunk)\n\n    ...\n\n    return chunk, nil\n}\n\n\nfunc myFunction() (*MyStructType, error) {\n    var chunk MyStructType\n\n    ...\n\n    return &chunk, nil\n}\n\ni.e., allocate a new struct and return it.\nIf I'd written that in C, the first one would have put an object on the heap and the second would have put it on the stack. The first would return a pointer to the heap, the second would return a pointer to the stack, which would have evaporated by the time the function had returned, which would be a Bad Thing.\nIf I'd written it in Python (or many other modern languages except C#) example 2 would not have been possible.\nI get that Go garbage collects both values, so both of the above forms are fine.\nTo quote:\n\nNote that, unlike in C, it's perfectly OK to return the address of a\nlocal variable; the storage associated with the variable survives\nafter the function returns. In fact, taking the address of a composite\nliteral allocates a fresh instance each time it is evaluated, so we\ncan combine these last two lines.\nhttp://golang.org/doc/effective_go.html#functions\n\nBut it raises a couple of questions.\n\nIn example 1, the struct is declared on the heap. What about example 2? Is that declared on the stack in the same way it would be in C or does it go on the heap too?\n\nIf example 2 is declared on the stack, how does it stay available after the function returns?\n\nIf example 2 is actually declared on the heap, how is it that structs are passed by value rather than by reference? What's the point of pointers in this case?", "output": "It's worth noting that the words \"stack\" and \"heap\" do not appear anywhere in the language spec.  Your question is worded with \"...is declared on the stack,\" and \"...declared on the heap,\" but note that Go declaration syntax says nothing about stack or heap.\nThat technically makes the answer to all of your questions implementation dependent.  In actuality of course, there is a stack (per goroutine!) and a heap and some things go on the stack and some on the heap.  In some cases the compiler follows rigid rules (like \"new always allocates on the heap\") and in others the compiler does \"escape analysis\" to decide if an object can live on the stack or if it must be allocated on the heap.\nIn your example 2, escape analysis would show the pointer to the struct escaping and so the compiler would have to allocate the struct.  I think the current implementation of Go follows a rigid rule in this case however, which is that if the address is taken of any part of a struct, the struct goes on the heap.\nFor question 3, we risk getting confused about terminology.  Everything in Go is passed by value, there is no pass by reference.  Here you are returning a pointer value.  What's the point of pointers?  Consider the following modification of your example:\ntype MyStructType struct{}\n\nfunc myFunction1() (*MyStructType, error) {\n    var chunk *MyStructType = new(MyStructType)\n    // ...\n    return chunk, nil\n}\n\nfunc myFunction2() (MyStructType, error) {\n    var chunk MyStructType\n    // ...\n    return chunk, nil\n}\n\ntype bigStruct struct {\n    lots [1e6]float64\n}\n\nfunc myFunction3() (bigStruct, error) {\n    var chunk bigStruct\n    // ...\n    return chunk, nil\n}\n\nI modified myFunction2 to return the struct rather than the address of the struct.  Compare the assembly output of myFunction1 and myFunction2 now,\n--- prog list \"myFunction1\" ---\n0000 (s.go:5) TEXT    myFunction1+0(SB),$16-24\n0001 (s.go:6) MOVQ    $type.\"\".MyStructType+0(SB),(SP)\n0002 (s.go:6) CALL    ,runtime.new+0(SB)\n0003 (s.go:6) MOVQ    8(SP),AX\n0004 (s.go:8) MOVQ    AX,.noname+0(FP)\n0005 (s.go:8) MOVQ    $0,.noname+8(FP)\n0006 (s.go:8) MOVQ    $0,.noname+16(FP)\n0007 (s.go:8) RET     ,\n\n--- prog list \"myFunction2\" ---\n0008 (s.go:11) TEXT    myFunction2+0(SB),$0-16\n0009 (s.go:12) LEAQ    chunk+0(SP),DI\n0010 (s.go:12) MOVQ    $0,AX\n0011 (s.go:14) LEAQ    .noname+0(FP),BX\n0012 (s.go:14) LEAQ    chunk+0(SP),BX\n0013 (s.go:14) MOVQ    $0,.noname+0(FP)\n0014 (s.go:14) MOVQ    $0,.noname+8(FP)\n0015 (s.go:14) RET     ,\n\nDon't worry that myFunction1 output here is different than in peterSO's (excellent) answer.  We're obviously running different compilers.  Otherwise, see that I modfied myFunction2 to return myStructType rather than *myStructType.  The call to runtime.new is gone, which in some cases would be a good thing.  Hold on though, here's myFunction3,\n--- prog list \"myFunction3\" ---\n0016 (s.go:21) TEXT    myFunction3+0(SB),$8000000-8000016\n0017 (s.go:22) LEAQ    chunk+-8000000(SP),DI\n0018 (s.go:22) MOVQ    $0,AX\n0019 (s.go:22) MOVQ    $1000000,CX\n0020 (s.go:22) REP     ,\n0021 (s.go:22) STOSQ   ,\n0022 (s.go:24) LEAQ    chunk+-8000000(SP),SI\n0023 (s.go:24) LEAQ    .noname+0(FP),DI\n0024 (s.go:24) MOVQ    $1000000,CX\n0025 (s.go:24) REP     ,\n0026 (s.go:24) MOVSQ   ,\n0027 (s.go:24) MOVQ    $0,.noname+8000000(FP)\n0028 (s.go:24) MOVQ    $0,.noname+8000008(FP)\n0029 (s.go:24) RET     ,\n\nStill no call to runtime.new, and yes it really works to return an 8MB object by value.  It works, but you usually wouldn't want to.  The point of a pointer here would be to avoid pushing around 8MB objects."}
{"instruction": "Answer the following programming question.", "input": "My source files tree is like this:\n/src\n  /pkg\n    /foo\n      foo.go\n      foo_test.go\n\nInside foo.go:\npackage foo\n\nfunc bar(n int) {\n    ...\n}\n\ninside foo_test.go:\npackage foo\n\nfunc testBar(t *testing.T) {\n    bar(10)\n    ...\n}\n\nMy questions are:\n\nDoes package name relates to directory name, source file name?\nIf there is only one source file for a package, need I put it in a directory?\nShould I put foo.go and foo_test.go in the same package?\nIn the foo_test.go, as it's in the same package as foo.go, I didn't import foo. But when I compile foo_test.go with 6g, it says bar() is undefined. What should I do?", "output": "1 - The language spec says the following: \n\nA set of files sharing the same PackageName form the implementation of a package. An implementation may require that all source files for a package inhabit the same directory.\n\nSo it seems that there is no requirement on the naming of files / directories, but it would be safer to put all file that form a package in one directory.\n2 - Obviously the file must be in some directory. I assume you mean \"should I put it in a subdirectory of src?\" It seems to me based on the above quote that you could have all your files in src directly if you really wanted to.\n3 - Yes.\n4 - Use go test"}
{"instruction": "Answer the following programming question.", "input": "I have a json file (themes/snow/theme.json)\n{\n    Name:'snow',\n    Bgimage:'background.jpg',\n    Width:600,\n    Height:400,\n    Itemrotation:'20,40',\n    Text:{\n        Fontsize:12,\n        Color:'#ff00ff',\n        Fontfamily:'verdana',\n        Bottommargin:20\n    },\n    Decoration:[\n        {\n            Path:'abc.jpg',\n            X:2,\n            Y:4,\n            Rotation:0\n        },\n        {\n            Path:'def.png',\n            X:4,\n            Y:22,\n            Rotation:10\n        }\n    ]\n}\n\nAnd I have a file that parse the json data\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"encoding/json\"\n    \"io/ioutil\"\n    \"log\"\n)\n\nconst themeDirectory    = \"themes\"\nconst themeJsonFile     = \"theme.json\"\n\ntype TextInfo struct {\n    Fontsize        int\n    Color           string\n    Fontfamily      string\n    Bottommargin    int\n}\n\ntype DecoInfo struct {\n    Path            string\n    X               int\n    Y               int\n    Rotation        int\n}\n\ntype ThemeInfo struct {\n    Name            string\n    Bgimage         string\n    Width           int\n    Height          int\n    Itemrotation    string\n    Text            textInfo\n    Decoration      []decoInfo\n}\n\nfunc main() {\n    var tinfo = parseTheme(\"snow\")\n        //use tinfo to build graphics\n}\n\nfunc parseTheme(themename string) themeInfo {\n    abspath, _ := os.Getwd()\n    filename :=  abspath + \"/\" + themeDirectory + \"/\" + themename + \"/\" + themeJsonFile\n\n    //Check this file exists\n    if _, error := os.Stat(filename); error != nil {\n        if os.IsNotExist(error) {\n            log.Fatal(filename + \" does not exist\")\n            os.Exit(1)\n        }\n    } \n\n    filebyte, error := ioutil.ReadFile(filename) \n    if error != nil { \n        log.Fatal(\"Could not read file \" + filename + \" to parse\")\n        os.Exit(1) \n    } \n\n    var t themeInfo\n    json.Unmarshal(filebyte, &t) \n    fmt.Println(t)\n    return t\n}\n\nYou can see I have 2 lines before the end\n fmt.Println(t)\n\nI am not sure why does it print \n{  0 0  {0   0} []}\n\nI expect it should return me themeInfo in a usable way, so that I can use it for further  processing.What am I doing wrong here?", "output": "Your JSON is not valid. JavaScript allows single quotes; JSON does not. Further, the object keys must be double quoted:\nValid:\n\n{ \"name\": \"Simon\" }\n\nInvalid:\n\n{ name: \"Simon\" }\n{ 'name': \"Simon\" }\n{ \"name\": 'Simon' }\n\nIf you wrap your JSON keys and values with double quotes, you'll see the expected output:\n{snow background.jpg 600 400 20,40 {12 #ff00ff verdana 20} [{abc.jpg 2 4 0} {def.png 4 22 10}]}\n\nFor exmaple,\nconst sampleTheme       = `{\n    \"Name\":\"snow\",\n    \"Bgimage\":\"background.jpg\",\n    \"Width\":600,\n    \"Height\":400,\n    \"Itemrotation\":\"20,40\",\n    \"Text\":{\n        \"Fontsize\":12,\n        \"Color\":\"#ff00ff\",\n        \"Fontfamily\":\"verdana\",\n        \"Bottommargin\":20\n    },\n    \"Decoration\":[\n        {\n            \"Path\":\"abc.jpg\",\n            \"X\":2,\n            \"Y\":4,\n            \"Rotation\":0\n        },\n        {\n            \"Path\":\"def.png\",\n            \"X\":4,\n            \"Y\":22,\n            \"Rotation\":10\n        }\n    ]\n}`\n\nFor the full program, see: http://play.golang.org/p/SLhaLbJcla"}
{"instruction": "Answer the following programming question.", "input": "I'm storing some data in a Go app in a struct's vector.Vector for convenience. I want to display all the data from the vector on Google App Engine webpage through template.Execute. Is it possible and how would I access the data in the parsed html file? Would it be easier if I used an array or slice instead?", "output": "Use slices.\n\nGo Weekly Snapshot History 2011-10-18\nThe container/vector package has been deleted. Slices are better:\n  SliceTricks."}
{"instruction": "Answer the following programming question.", "input": "Does anyone know if it's possible to use the \"go build\" command to build from multiple files in a directory?  For example\nsrc/\n  file1.go\n  file2.go\n\nWhere file1.go contains the \"func main()\" method and file2 provides supporting functions.  I've tried by using the following import statements but I'm getting no where\nimport (\n  \"file2\"\n)\n\nimport (\n  file2 \"./file2\"\n)\n\nI'm wondering if this is a case that I need to modify the GOROOT environment variable to get this to work.  Or if I'm just being daft and missing something blindingly obvious.\nThanks", "output": "If file1.go and file2.go are part of the same package, this should work fine. You don't have to import files from the same package into each other. Their variables and functions are already shared.\nIf the files belong to different packages, they should be in different directories."}
{"instruction": "Answer the following programming question.", "input": "I'm writing a Google App Engine Go application. In it, I want to handle some calls separately in different .go files. Should I call \"init()\" function separately in each of those files, or just declare it in one file and call some other functions for initialisation of each .go file?\nFor example, if I'd have two files, user.go:\npackage User\n\nimport(\n    \"http\"\n    \"fmt\"\n)\n\nfunc init() {\n    http.HandleFunc(\"/\", hello)\n}\n\nfunc hello(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"Hello, user!\")\n}\n\nAnd admin.go:\npackage Admin\n\nimport(\n    \"http\"\n    \"fmt\"\n)\n\nfunc init() {\n    http.HandleFunc(\"/admin/\", hello)\n}\n\nfunc hello(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"Hello, admin!\")\n}\n\nIs such an initialisation correct, or is it advised against something like this?", "output": "According to Go language specification:\n\nall initialization code is run in a single goroutine, and\ninit() functions within a single package execute in unspecified order\n\nIn your case, the packages User and Admin are independent (User does not import Admin, nor Admin imports User). This means that:\n\nthe two init() functions in User and Admin execute in unspecified order\n\n\nJoining the bodies of the two init() functions in a single init() function would look like this:\nfunc init() {\n    http.HandleFunc(\"/\", User.Hello)\n    http.HandleFunc(\"/admin/\", Admin.Hello)\n}\n\nNotice that it is irrelevant whether the program first registers \"/\" or \"/admin/\". So, the following code is also valid :\nfunc init() {\n    http.HandleFunc(\"/admin/\", Admin.Hello)\n    http.HandleFunc(\"/\", User.Hello)\n}\n\nFrom the above two snippets of code, we can see that it is OK for http.HandleFunc(\"/\", ...) and http.HandleFunc(\"/admin/\", ...) to be called in unspecified order.\n\nBecause \"/\" and \"/admin/\" can be registered in any order, and all init() functions run in a single goroutine, the answer to your question is: Yes, such an initialisation correct."}
{"instruction": "Answer the following programming question.", "input": "I am writing a web server wherein I need to register handlers at runtime. E.g. \"/create\" would create a new handler for all URLs like \"/123/*\" and so on. I need a corresponding \"/destroy/123\" which would unregister the handler for \"/123/*\".\nHere's the code for handling \"/create\"\npackage main\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\ntype MyHandler struct {\n    id int\n}\nfunc (hf *MyHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintln(w, r.URL.Path)\n}\n\n// Creates MyHandler instances and registers them as handlers at runtime\ntype HandlerFactory struct {\n    handler_id int\n}\nfunc (hf *HandlerFactory) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    hf.handler_id++\n    handler := MyHandler{hf.handler_id}\n    handle := fmt.Sprintf(\"/%d/\", hf.handler_id)\n    http.Handle(handle, &handler)\n}\n\nfunc main() {\n    factory := HandlerFactory{0}\n    http.Handle(\"/create\", &factory)\n    http.ListenAndServe(\"localhost:8080\", nil)\n}\n\nI tried implementing my own multiplexer by embedding http.ServeMux but it holds its pattern-to-Handler mapping in a private variable (ServeMux.m)", "output": "What I would do is create a custom ServerMux. Copy the code from GOROOT/src/pkg/net/http/server.go. It starts on line 837 and ends at 939.\nThe custom ServerMux would need a method for deregistration. This should be easy to implement. Just grab the lock and del() the map entry. For example (all code untested):\n// TODO: check if registered and return error if not.\n// TODO: possibly remove the automatic permanent link between /dir and /dir/.\nfunc (mux *MyMux) Deregister(pattern string) error {\n    mux.mu.Lock()\n    defer mux.mu.Unlock()\n    del(mux.m, pattern)\n    return nil\n}\n\nIn order to use this new mux, you would do something like this:\nmux := newMux()\nmux.Handle(\"/create\", &factory)\n\nsrv := &http.Server {\n    Addr: localhost:8080\n    Handler: mux,\n}\nsrv.ListenAndServe()\n\nModifying mux by calling deregister() from another goroutine is completely safe and will modify the way ListenAndServe() routes messages."}
{"instruction": "Answer the following programming question.", "input": "Is it possible in go to get system time in less than nano second means in pico-second or like that? Actually, I want to measure two consecutive events time gap which I can't catch in nano-second in our fast system.", "output": "The cost of calling profiling functions/instructions on modern hardware is larger (and mor espread and prone to deviance) than the interval you're going to measure. So even if you try, you'll get erroneous results.\nConsider tracking time lapse for 100 events, if that's at all possible."}
{"instruction": "Answer the following programming question.", "input": "I'm trying out LiteIDE for golang and there are no docs to speak of and apparently no forum.  I've set the Env for my environment and go installation.  When I try to use it on the hello.go file (as a file or a a project) all I get is\n<action id=\"Run\" cmd=\"${TARGETPATH}\" args=\"${TARGETARGS}\">\n<start=\" \" workdir=\"C:/liteide.projects\"/>\n \n\n<error msg=\"process failed to start\" />\n\n</action>\n\n(Sorry for the formatting but the Code Sample tags in this forum can't handle XML blocks.)\nLots of other people have seen the same thing.\nWhat are the TARGETPATH and TARGETARGS that is shown?\nIs there any documentation on how to configure LiteIDE?", "output": "LiteIDE apparently does not work.  I filed this bug report and their advice was to try a recent beta of the next release.  That didn't work either, however."}
{"instruction": "Answer the following programming question.", "input": "Assuming that we have:\nhttp.HandleFunc(\"/smth\", smthPage)\nhttp.HandleFunc(\"/\", homePage)\n\nUser sees a plain \"404 page not found\" when they try a wrong URL. How can I return a custom page for that case?\nUpdate concerning gorilla/mux\nAccepted answer is ok for those using pure net/http package.\nIf you use gorilla/mux you should use something like this:\nfunc main() {\n    r := mux.NewRouter()\n    r.NotFoundHandler = http.HandlerFunc(notFound)\n}\n\nAnd implement func notFound(w http.ResponseWriter, r *http.Request) as you want.", "output": "I usually do this:\npackage main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", homeHandler)\n    http.HandleFunc(\"/smth/\", smthHandler)\n    http.ListenAndServe(\":12345\", nil)\n}\n\nfunc homeHandler(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path != \"/\" {\n        errorHandler(w, r, http.StatusNotFound)\n        return\n    }\n    fmt.Fprint(w, \"welcome home\")\n}\n\nfunc smthHandler(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path != \"/smth/\" {\n        errorHandler(w, r, http.StatusNotFound)\n        return\n    }\n    fmt.Fprint(w, \"welcome smth\")\n}\n\nfunc errorHandler(w http.ResponseWriter, r *http.Request, status int) {\n    w.WriteHeader(status)\n    if status == http.StatusNotFound {\n        fmt.Fprint(w, \"custom 404\")\n    }\n}\n\nHere I've simplified the code to only show custom 404, but I actually do more with this setup: I handle all the HTTP errors with errorHandler, in which I log useful information and send email to myself."}
{"instruction": "Answer the following programming question.", "input": "This seems almost right but it chokes on the newline.\nWhat's the best way to do this?\npackage main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    var z float64\n    var a []float64\n    // \\n gives an error for Fscanf\n    s := \"3.25 -12.6 33.7 \\n 3.47\"\n    in := strings.NewReader(s)\n    for {\n        n, err := fmt.Fscanf(in, \"%f\", &z)\n        fmt.Println(\"n\", n)\n        if err != nil {\n            break\n        }\n        a = append(a, z)\n    }\n    fmt.Println(a)\n}\n\nOutput:\nn 1\nn 1\nn 1\nn 0\n[3.25 -12.6 33.7]\n\nUpdate:\nSee the answer from @Atom below.  I found another way which is to break if the error is EOF, and otherwise just ignore it.  It's just a hack, I know, but I control the source.\n    _, err := fmt.Fscanf(in, \"%f\", &z)\n    if err == os.EOF { break }\n    if err != nil { continue }", "output": "If you are parsing floats only, you can use fmt.Fscan(r io.Reader, a ...interface{}) instead of fmt.Fscanf(r io.Reader, format string, a ...interface{}):\nvar z float64\n...\nn, err := fmt.Fscan(in, &z)\n\nThe difference between fmt.Fscan and fmt.Fscanf is that in the case of fmt.Fscan newlines count as space. The latter function (with a format string) does not treat newlines as spaces and requires newlines in the input to match newlines in the format string.\nThe functions with a format string give more control over the form of input, such as when you need to scan %5f or %10s. In this case, if the input contains newlines and it implements the interface io.RuneScanner you can use the method ReadRune to peek the next character and optionally unread it with UnreadRune if it isn't a space or a newline."}
{"instruction": "Answer the following programming question.", "input": "Is there any Go collection similar to 'Set's in python? \nalternatives: \n\nIs there an easy way of implementing Sets in Go?\nIs there any method to eliminate duplicates in a slice?", "output": "You could just have a map[whatevertype]bool and set the value to true. You could add every element in a slice as a map key, then use a range to get only the unique ones back out.\npackage main\nimport \"fmt\"\nfunc main() {\n    m := make(map[string]bool)\n    s := make([]string, 0)\n    s = append(s, \"foo\")\n    s = append(s, \"foo\")\n    s = append(s, \"foo\")\n    s = append(s, \"bar\")\n    s = append(s, \"bar\")\n    for _, r := range s {\n        m[r] = true\n    }\n    s = make([]string, 0)\n    for k, _ := range m {\n        s = append(s, k)\n    }\n    fmt.Printf(\"%v\\n\", s)\n}"}
{"instruction": "Answer the following programming question.", "input": "I get a byte slice ([]byte) from a UDP socket and want to treat it as an integer slice ([]int32) without changing the underlying array, and vice versa. In C(++) I would just cast between pointer types; how would I do this in Go?", "output": "As others have said, casting the pointer is considered bad form in Go. Here are examples of the proper Go way and the equivalent of the C array casting.\nWARNING: all code untested.\nThe Right Way\nIn this example, we are using the encoding/binary package to convert each set of 4 bytes into an int32. This is better because we are specifying the endianness. We are also not using the unsafe package to break the type system.\nimport \"encoding/binary\"\n\nconst SIZEOF_INT32 = 4 // bytes\n\ndata := make([]int32, len(raw)/SIZEOF_INT32)\nfor i := range data {\n    // assuming little endian\n    data[i] = int32(binary.LittleEndian.Uint32(raw[i*SIZEOF_INT32:(i+1)*SIZEOF_INT32]))\n}\n\nThe Wrong Way (C array casting)\nIn this example, we are telling Go to ignore the type system. This is not a good idea because it may fail in another implementation of Go. It is assuming things not in the language specification. However, this one does not do a full copy. This code uses unsafe to access the \"SliceHeader\" which is common in all slices. The header contains a pointer to the data (C array), the length, and the capacity. Instead of just converting the header to the new slice type, we first need to change the length and capacity since there are less elements if we treat the bytes as a new type.\nimport (\n    \"reflect\"\n    \"unsafe\"\n)\n\nconst SIZEOF_INT32 = 4 // bytes\n\n// Get the slice header\nheader := *(*reflect.SliceHeader)(unsafe.Pointer(&raw))\n\n// The length and capacity of the slice are different.\nheader.Len /= SIZEOF_INT32\nheader.Cap /= SIZEOF_INT32\n\n// Convert slice header to an []int32\ndata := *(*[]int32)(unsafe.Pointer(&header))"}
{"instruction": "Answer the following programming question.", "input": "Given the following simple Go program\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc total(ch chan int) {\n    res := 0\n    for iter := range ch {\n        res += iter\n    }\n    ch <- res\n}\n\nfunc main() {\n    ch := make(chan int)\n    go total(ch)\n    ch <- 1\n    ch <- 2\n    ch <- 3\n    fmt.Println(\"Total is \", <-ch)\n}\n\nI am wondering if someone can enlighten me as to why I get\nthrow: all goroutines are asleep - deadlock!\n\nthank you", "output": "As you never close the ch channel, the range loop will never finish.\nYou can't send back the result on the same channel. A solution is to use a different one.\nYour program could be adapted like this :\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc total(in chan int, out chan int) {\n    res := 0\n    for iter := range in {\n        res += iter\n    }\n    out <- res // sends back the result\n}\n\nfunc main() {\n    ch := make(chan int)\n    rch  := make(chan int)\n    go total(ch, rch)\n    ch <- 1\n    ch <- 2\n    ch <- 3\n    close (ch) // this will end the loop in the total function\n    result := <- rch // waits for total to give the result\n    fmt.Println(\"Total is \", result)\n}"}
{"instruction": "Answer the following programming question.", "input": "im am writing a simple emulator in go (should i? or should i go back to c?).\nanyway, i am fetching the instruction and decoding it. at this point i have a byte like 0x81, and i have to execute the right function.\nshould i have something like this\nfunc (sys *cpu) eval() {\n    switch opcode {\n    case 0x80:\n        sys.add(sys.b)\n    case 0x81:\n        sys.add(sys.c)\n    etc\n    }\n}\n\nor something like this\nvar fnTable = []func(*cpu) {\n    0x80: func(sys *cpu) {\n        sys.add(sys.b)\n    },\n    0x81: func(sys *cpu) {\n        sys.add(sys.c)\n    }\n}\nfunc (sys *cpu) eval() {\n    return fnTable[opcode](sys)\n}\n\n1.which one is better?\n2.which one is faster?\nalso\n3.can i declare a function inline?\n4.i have a cpu struct in which i have the registers etc. would it be faster if i have the registers and all as globals? (without the struct)\nthank you very much.", "output": "The first version looks better to me, YMMV.\nBenchmark it. Depends how good is the compiler at optimizing. The \"jump table\" version might be faster if the compiler doesn't try hard enough to optimize.\nDepends on your definition of what is \"to declare function inline\". Go can declare and define functions/methods at the top level only. But functions are first class citizens in Go, so one can have variables/parameters/return values and structured types of function type. In all this places a function literal can [also] be assigned to the variable/field/element...\nPossibly. Still I would suggest to not keep the cpu state in a global variable. Once you possibly decide to go emulating multicore, it will be welcome ;-)"}
{"instruction": "Answer the following programming question.", "input": "I wish to implement the fmt.Stringer interface's String method. However for a set of types deriving from Node, their String implementations would be a wrapper around a Print interface method they must provide. How can I provide String automatically for all types implementing Node? If I provide the default String on some base class, I lose access to the derived type (and thus the interface method Print).\ntype Node interface {\n    fmt.Stringer\n    Print(NodePrinter)\n}\n\ntype NodeBase struct{}\n\nfunc (NodeBase) String() string {\n    np := NewNodePrinter()\n    // somehow call derived type passing the NodePrinter\n    return np.Contents()\n}\n\ntype NodeChild struct {\n    NodeBase\n    // other stuff\n}\n\nfunc (NodeChild) Print(NodePrinter) {\n    // code that prints self to node printer\n}", "output": "Go explicitly declares that it's not possible:\n\nWhen we embed a type, the methods of that type become methods of the outer type, but when they are invoked the receiver of the method is the inner type, not the outer one.\n\nFor a solution, I recommend something like this:\nfunc nodeString(n Node) string {\n    np := NewNodePrinter()\n    // do stuff\n    n.Print(np)\n    return np.Contents()\n}\n\n// Now you can add String method to any Node in one line\nfunc (n NodeChild) String() string { return nodeString(n) }"}
{"instruction": "Answer the following programming question.", "input": "package main\n\nimport \"rpc/jsonrpc\"\nimport \"fmt\"\n\nfunc main() {\n    rc, e := jsonrpc.Dial(\"tcp\", \"user:pass@localhost:8332\")\n    if e != nil {fmt.Print(e);return;}\n\n    var blocks float64\n    rc.Call(\"getblockcount\", \"\", &blocks)\n    if e != nil {fmt.Print(e); return;}\n    fmt.Print(\"%f blocks\", blocks)\n}\n\nGives me the following error: \ndial tcp user:pass@localhost:8332: too many colons in address user:pass@localhost:8332\nHow do I authenticate my rpc connection?", "output": "testRequest := `{\"jsonrpc\": \"1.0\", \"id\":\"\", \"method\": \"help\", \"params\": []}`\n\nrequest, e := http.NewRequest(\"POST\", brpc.addr, strings.NewReader(testRequest))\nrequest.SetBasicAuth(brpc.user, brpc.pass)\n\nresponce, e := brpc.c.Do(request)\n// responce.Body has the result"}
{"instruction": "Answer the following programming question.", "input": "I have a Go object whose address in memory I would like to keep constant. in C# one can pin an object's location in memory. Is there a way to do this in Go?", "output": "An object on which you keep a reference won't move. There is no handle or indirection, and the address you get is permanent. \nFrom the documentation :\n\nNote that, unlike in C, it's perfectly OK to return the address of a\n  local variable; the storage associated with the variable survives\n  after the function returns\n\nWhen you set a variable, you can read this address using the & operator, and you can pass it."}
{"instruction": "Answer the following programming question.", "input": "I am running this code in the sandbox in http://tour.golang.org/\nI thought that once I launched the goroutine that ranges over the channel, all values I would send through would be printed.\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    c := make(chan int)\n\n    go (func(c chan int){\n        for v := range c {\n            fmt.Println(v)\n        }\n    })(c)\n\n    c <- 1\n    c <- 2\n    c <- 3\n    c <- 4   \n//  c <- 5  // uncomment to send more values\n//  c <- 6\n    close(c)\n}\n\nBut if I send an odd number of values (say, 1, 2 and 3), all values get printed.\nIf I send an even number of values(say, 1, 2, 3 and 4), the last one does not get printed.\nIt seems that the channel creation line:\n    c := make(chan int)\n\nChanges the behavior of the range expression when I add a buffer of different sizes:\n(I am sending 4 values)\n    c := make(chan int)     // prints 1,2,3\n    c := make(chan int, 1)  // same behavior, prints 1,2,3\n    c := make(chan int, 2)  // prints 1,2\n    c := make(chan int, 3)  // prints 1,2,3\n    c := make(chan int, 4)  // [no output]\n    c := make(chan int, 5)  // [no output]\n    c := make(chan int, 20) // [no output]\n\nWhy is it not receiving the last value when I send an even number?\n\nMore in this:\nI tested this offline also, compiling under 64 bit Linux.\nI changed the program a little:\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    c := make(chan int)\n    cc := make(chan int)\n\n    p := func (c chan int){\n      for v := range c {\n        fmt.Println(v)\n      }\n    }\n\n    go p(c)\n    go p(cc)\n\n    c <- 1\n    c <- 2\n    c <- 3\n    c <- 4\n//  c <- 5\n//  c <- 6\n    cc <- 1000\n//  cc <- 2000\n    close(c)\n    close(cc)\n}\n\nIf I decomment the line cc <- 2000 then everything gets printed.  But if I leave it commented out, I only get 1, 2 and 3.\nSeems like a timing issue.  I thought that the line cc <- 1000 would block the main function until all channels get read.", "output": "You are thinking of a close as being more like a send than it is, according to the memory model:\n\nThe closing of a channel happens before a receive that returns a zero\n  value because the channel is closed.\n\nSo you are guaranteed that those close statements will complete before their corresponding loops terminate.  Since you also know the close statements must happen after the last send on those channels (since they are in the same go-routine) you know that all but the last value sent on them will be guaranteed to print.  I think what you were expecting was the close to act more like a send, so that the loop is forced to print its last value.  If you replace the close statements with a send of -1, for example, this will guarantee all of the values (except the -1's, possibly) will get printed.  Whether or not the -1's get printed is not guaranteed.\nObviously this is a simplification of something, but I think the 'proper' way to write your example would be to use a sync.WaitGroup.  It's very easy and is perfect for firing off several go-routines and waiting for them all to complete.  Here is your code re-written to use a WaitGroup:\npackage main\n\nimport (\n  \"fmt\"\n  \"sync\"\n)\n\nfunc main() {\n  c := make(chan int)\n  cc := make(chan int)\n\n  var wg sync.WaitGroup\n\n  p := func(c chan int) {\n    for v := range c {\n      fmt.Println(v)\n    }\n    wg.Done()\n  }\n\n  wg.Add(2)\n  go p(c)\n  go p(cc)\n\n  c <- 1\n  c <- 2\n  c <- 3\n  c <- 4\n  cc <- 1000\n  cc <- 2000\n  close(c)\n  close(cc)\n  wg.Wait()\n}"}
{"instruction": "Answer the following programming question.", "input": "I am trying to test an AppEngine/Go application. I start dev_appserver.py and it begins serving the application, but when I go to localhost:8080 in my browser, I get:\nCompile error:\n/home/adam/foobar/server/app/server.go:5: can't find import: appengine/users\n\n2011/08/23 19:45:34 go-app-builder: Failed building app: failed running 8g: exit status 1\n\nI feel as though I need to do something to make the AppEngine-specific libraries available where GO expects them to be, but I don't really want to run goinstall on everything that comes in the AppEngine/Go SDK zip, do I? I seem to have missed an installation step, but for the life of me, I can't figure the sane and right thing to do.\nI am on Ubuntu, if that matters.", "output": "The Users API isn't appengine/users - it's appengine/user. From the example on the App Engine page:\nimport (\n    \"appengine\"\n    \"appengine/user\"\n)\n\nfunc welcome(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n    u := user.Current(c)\n    if u == nil {\n        url := u.LoginURL(c, \"/\")\n        fmt.Fprintf(w, `<a href=\"%s\">Sign in or register</a>`, url)\n        return\n    }\n    url := user.LogoutURL(c, \"/\")\n    fmt.Fprintf(w, `Welcome, %s! (<a href=\"%s\">sign out</a>)`, u, url)\n}"}
{"instruction": "Answer the following programming question.", "input": "I understand that the Go programming language doesn't really support dynamic linking.  This makes me wonder, what would somebody do if they wanted to write an application that supported third party (or otherwise contributed) plug-ins?  \nIt seems the typical response is that Go compiles quickly, so just recompile, but I don't find this all that practical for system administrators.  The Apache web server for example, has an amazing number of modules that can be configured to be loaded (or not loaded) very easily.\nIs the only option left to use sockets or other IPC for plugins?", "output": "What I would do, is, set up an API through, say, channel over pipe. And tell the plugin author to issue an exe that communicate over this pipe.\nThis is similar to how Chrome works today.\nThis is a way to achieve that over netchan.\nNote: the netchan pacakage is deprecated, but the idea is to use RPC over unix pipes."}
{"instruction": "Answer the following programming question.", "input": "When i try to use cgo I get the error\nexec gcc: exec: \"gcc\": executable file not found in %PATH%\nI have Mingw installed. How do I tell Goclipse where gcc is? I could not find a way in preferences or properties to set this.", "output": "Add the path to MinGW gcc to your Windows PATH environment variable.\nSetting environment variables under Windows"}
{"instruction": "Answer the following programming question.", "input": "You have a function with an argument, a pointer to a type.\ntype bar struct{...}\n\nfunc foo(arg *bar)\n\nIs there any difference between:\nvar b bar\nfoo(&b)\n\nand\nb := new(bar)\nfoo(b)\n\nThe use of new creates an allocation.", "output": "No, there is no difference, as, contrary to C, Go explicitly states that you can give a pointer to a locally created variable.\nFrom the documentation :\n\nNote that, unlike in C, it's perfectly OK to return the address of a\n  local variable; the storage associated with the variable survives\n  after the function returns"}
{"instruction": "Answer the following programming question.", "input": "What's the best way to get the current timestamp in Go and convert to string? I need both date and time in eg. YYYYMMDDhhmmss format.", "output": "Use the time.Now() function and the time.Format() method.\nt := time.Now()\nfmt.Println(t.Format(\"20060102150405\"))\n\nprints out 20110504111515, or at least it did a few minutes ago. (I'm on Eastern Daylight Time.) There are several pre-defined time formats in the constants defined in the time package.\nYou can use time.Now().UTC() if you'd rather have UTC than your local time zone."}
{"instruction": "Answer the following programming question.", "input": "To define a map from int to struct vertex, should I define map[int]vertex or map[int]*vertex? Which one is preferred?\nI extended Chickencha's code:\npackage main\n\ntype vertex struct {\n    x, y int \n}\n\nfunc main() {\n    a := make(map[int]vertex)\n    b := make(map[int]*vertex)\n\n    v := &vertex{0, 0}\n    a[0] = *v\n    b[0] = v \n\n    v.x, v.y = 4, 4\n    println(a[0].x, a[0].y, b[0].x, b[0].y)\n\n    //a[0].x = 3 // cannot assign to (a[0]).x\n    //a[0].y = 3 // cannot assign to (a[0]).y\n    b[0].x = 3 \n    b[0].y = 3 \n    println(a[0].x, a[0].y, b[0].x, b[0].y)\n\n    u1 := a[0]\n    u1.x = 2 \n    u1.y = 2 \n    u2 := b[0]\n    u2.x = 2 \n    u2.y = 2 \n    println(a[0].x, a[0].y, b[0].x, b[0].y)\n}\n\nThe output:\n0 0 4 4\n0 0 3 3\n0 0 2 2\n\nFrom the output, my understanding is, if I want to change the struct member in place, I must use pointer to the struct.\nBut I'm still not sure the underlying reasons. Especially, why I cannot assign to a[0].x?", "output": "The main difference is that map[int]vertex stores vertex values and map[int]*vertex stores vertex references (pointers). The output of the following program should help illustrate:\npackage main\n\ntype vertex struct {\n    x, y int\n}\n\nfunc main() {\n    a := make(map[int]vertex)\n    b := make(map[int]*vertex)\n\n    v := &vertex{0, 0}\n    a[0] = *v\n    b[0] = v\n\n    v.x, v.y = 4, 4\n    println(a[0].x, a[0].y, b[0].x, b[0].y)\n}\n\nOutput:\n0 0 4 4\n\nThe vertex stored in b is modified by the v.x, v.y = 4, 4 line, while the vertex stored in a is not."}
{"instruction": "Answer the following programming question.", "input": "The ability to read (and write) a text file into and out of a string array is I believe a fairly common requirement. It is also quite useful when starting with a language removing the need initially to access a database. Does one exist in Golang?\ne.g. \nfunc ReadLines(sFileName string, iMinLines int) ([]string, bool) {\n\nand   \nfunc WriteLines(saBuff[]string, sFilename string) (bool) { \n\nI would prefer to use an existing one rather than duplicate.", "output": "As of Go1.1 release, there is a bufio.Scanner API that can easily read lines from a file.  Consider the following example from above, rewritten with Scanner:\npackage main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n)\n\n// readLines reads a whole file into memory\n// and returns a slice of its lines.\nfunc readLines(path string) ([]string, error) {\n    file, err := os.Open(path)\n    if err != nil {\n        return nil, err\n    }\n    defer file.Close()\n\n    var lines []string\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() {\n        lines = append(lines, scanner.Text())\n    }\n    return lines, scanner.Err()\n}\n\n// writeLines writes the lines to the given file.\nfunc writeLines(lines []string, path string) error {\n    file, err := os.Create(path)\n    if err != nil {\n        return err\n    }\n    defer file.Close()\n\n    w := bufio.NewWriter(file)\n    for _, line := range lines {\n        fmt.Fprintln(w, line)\n    }\n    return w.Flush()\n}\n\nfunc main() {\n    lines, err := readLines(\"foo.in.txt\")\n    if err != nil {\n        log.Fatalf(\"readLines: %s\", err)\n    }\n    for i, line := range lines {\n        fmt.Println(i, line)\n    }\n\n    if err := writeLines(lines, \"foo.out.txt\"); err != nil {\n        log.Fatalf(\"writeLines: %s\", err)\n    }\n}"}
{"instruction": "Answer the following programming question.", "input": "How's the visibility of members from a sub-package to its root package?\nThis is what I mean:\nfoo          // the \"root\" package\nfoo/utils    // a sub-package\nfoo/tools    // another sub-package\n\nCan foo access private members of foo/utils and foo/tools or do they act as separate, independant packages?", "output": "Go has no concept of sub-directories nor sub-packages. Packages are separate from each other. The import path \"foo/utils\" is just an import path (a method of how to find the package) - the string \"foo/utils\" has no significance other than locating the package on local disk or in the Internet.\nfoo cannot access private members of foo/utils.\nIn Go1, each directory in a source tree corresponds to a single package. More about this can be found here: the go command."}
{"instruction": "Answer the following programming question.", "input": "In bytes_test.go I see:\n a := Split([]byte(tt.s), []byte(tt.sep), tt.n)\n\nwhere tt.s and tt.sep are strings. But when I try to do \n a := bytes.Split([]byte(\"test\"), []byte(\"e\"), 0)\n\nI get: \n cannot convert \"test\" (type ideal string) to type []uint8 in conversion\n cannot convert \"e\" (type ideal string) to type []uint8 in conversion", "output": "The following is valid code using the latest release -- release.2010-03-04 -- which includes, amongst other things, this change: \"There is one language change: the ability to convert a string to []byte or []int.  This deprecates the strings.Bytes and strings.Runes functions.\"\npackage main\n\nimport (\"bytes\"; \"fmt\")\n\nfunc main() {\n    a := bytes.Split([]byte(\"test\"), []byte(\"e\"), 0)\n    fmt.Println(a)\n}\n\nUpdate to a current release of Go: Installing Go : Keeping up with releases."}
{"instruction": "Answer the following programming question.", "input": "I've read through the Effective Go and Go Tutorials as well as some source, but the exact mechanism behind the interface {} syntax is Go is somewhat mysterious to me. I first saw it when trying to implement heap.Interface and it seems to be a container of some kind (reminds me of a monad a little) from which I can extract values of arbitrary type.\nWhy is Go written to use this?  Is it some kind of workaround for generics? Is there a more elegant way to get values from a heap.Interface than having to dereference them with heap.Pop(&h).(*Foo) (in the case of a heap pointers to type Foo)?", "output": "interface{} is a generic box that can hold everything. Interfaces in go define a set of methods, and any type which implements these methods conforms to the interface. interface{} defines no methods, and so by definition, every single type conforms to this interface and therefore can be held in a value of type interface{}.\nIt's not really like generics at all. Instead, it's a way to relax the type system and say \"any value at all can be passed here\". The equivalent in C for this functionality is a void * pointer, except in Go you can query the type of the value that's being held."}
{"instruction": "Answer the following programming question.", "input": "What is the best practice to install packages (those with go get...) in a local directory?\nExample: I'd like to try out the Revel web framework, but I don't want to clutter my go installation at /usr/local/go.\nNormally I'd say sudo go get github.com/robfig/revel as written on the home page, but that would install it beneath /usr/local/go/src/pkg/....\nIs there an easy way to say (for example) go get --local ... and have the package in the current (sub) directory?", "output": "You can export the env variable GOPATH. For me it is ~/local/lib/go. This folder has the subfolders bin, pkg and src, so it's just like /usr/local/go. The go-tool will then automatically download , build and install packages into this directory."}
{"instruction": "Answer the following programming question.", "input": "func identityMat4() [16]float {\n    return {\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1 }\n}\n\nI hope you get the idea of what I'm trying to do from the example. How do I do this in Go?", "output": "func identityMat4() [16]float64 {\n    return [...]float64{\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1 }\n}\n\n(Click to play)"}
{"instruction": "Answer the following programming question.", "input": "I'm trying to hold a function that will return new instances of a type implementing a particular interface in a struct. Here's a stripped down example:\npackage main\n\ntype Adder interface {\n    Add(Adder)\n    Val() int\n}\n\ntype NewAdder func() Adder\n\ntype number int\n\ntype NewHolder struct {\n    newFunc NewAdder\n}\n\nfunc (me *number)Add(it Adder) {\n    *me += number(it.Val())\n}\n\nfunc (me *number)Val() int {\n    return int(*me)\n}\n\nfunc newAdder() *number {\n    return (*number)(new(int))\n}\n\nfunc main() {\n    var holder NewHolder\n    holder.newFunc = NewAdder(newAdder)\n}\n\nWhen I try to compile it, it says cannot convert newAdder (type func() *number) to type NewAdder. So what's the go-like way to accomplish my goal?\nHere's a Python example of what I'm trying to do, just for reference:\nclass NewStuffMaker(object):\n    def __init__(self, new):\n        self.new = new\n\ndef make_new():\n    return []\nobj = NewStuffMaker(make_new)\nnew_lst = obj.new()\n\nIdeally, I'd like to be able to hold a bunch of these functions (or structs containing the functions and some other data) in a slice. Is that an unreasonable thing to do?", "output": "package main\n\ntype Adder interface {\n    Add(Adder)\n    Val() int\n}\n\ntype FuncAdder func() Adder\n\ntype Holder struct {\n    FuncAdder\n    SomeOtherData string\n}\n\ntype number int\n\nfunc (n *number) Add(a Adder) {\n    *n += number(a.Val())\n}\n\nfunc (n *number) Val() int {\n    return int(*n)\n}\n\nfunc NumberAdder() Adder {\n    return Adder(new(number))\n}\n\nfunc main() {\n    var holders []Holder\n    var holder Holder\n    holder.FuncAdder = NumberAdder\n    holder.SomeOtherData = \"SomeOtherData\"\n    holders = append(holders, holder)\n}"}
{"instruction": "Answer the following programming question.", "input": "goinstall go-tour.googlecode.com/hg/gotour\n\nRunning the above command give me the following message ..\ngoinstall: encoding/json: go/build: package could not be found locally\ngoinstall: code.google.com/p/go-tour/pic: cannot download: code.google.com/p/go-tour/pic\ngoinstall: code.google.com/p/go-tour/tree: cannot download: code.google.com/p/go-tour/tree\ngoinstall: code.google.com/p/go-tour/wc: cannot download: code.google.com/p/go-tour/wc\ngoinstall: os/exec: go/build: package could not be found locally\ngoinstall: net/http: go/build: package could not be found locally\n\nI know that there is problem with path setting .. i also checked this post\nexport PATH=$PATH:/home/sakthi/sakthig/code/my/go/go/bin\nexport GOROOT=/home/sakthi/sakthig/code/my/go/go\nexport GOPATH=$GOROOT/bin\n\nThis is my current path setting.. any help ?", "output": "The Go Tour project has been updated recently.\nThe Go weekly.2011-11-09 release renamed the json package to encoding/json.\nThe Go weekly.2011-12-14 release changed the naming for the go-tour package import paths from \"go-tour.googlecode.com/hg/tree\" to \"code.google.com/p/go-tour/tree\".\nUpdate to the Go weekly release (Keeping up with releases).\n$ cd $GOROOT/src\n$ hg pull\n$ hg update weekly\n$ ./all.bash\n\nThen install the go-tour/tree package.\n$ cd $GOROOT\n$ goinstall -v -fix code.google.com/p/go-tour/tree\ngoinstall: open /home/peter/go/goinstall.log: no such file or directory\ngoinstall: code.google.com/p/go-tour/tree: download\ngoinstall: cd / && /usr/bin/hg clone https://code.google.com/p/go-tour /home/peter/go/src/pkg/code.google.com/p/go-tour\ngoinstall: selecting tip\ngoinstall: cd /home/peter/go/src/pkg/code.google.com/p/go-tour && /usr/bin/hg update\ngoinstall: code.google.com/p/go-tour/tree: install\ngoinstall: cd /home/peter/go/src/pkg/code.google.com/p/go-tour/tree && /bin/bash gomake -f- install\n$"}
{"instruction": "Answer the following programming question.", "input": "I know I can wait on multiple channels using the select {} syntax in Go, and wait on multiple file descriptors using syscall.Select() or similar functions.  But is it possible to wait on both channels at once?\nFor background, I want to have a goroutine that accepts for messages over a channel and forwards them over a socket connection (provided by gozmq), while simultaneously waiting for replies on the socket connection.\nDue to the thread safety requirements of the underlying library, the socket can only be accessed in one thread at a time, which is why I was wondering if there is a way to handle this from a single goroutine.", "output": "Selecting on both a channel and an file descriptor is not possible because the abstractions are at different levels. Channels are handled by the go runtime and file descriptors by the operating system. What you need is to make a bridge between them and this can be done with a net.Pipe().\nPretty much what you need to do is dedicate one goroutine to epoll()/select() to watch your zmq-sockets and a single \"wake up\" net.Pipe(). This is your poll server. Another goroutine listens on your read and write channels. When someone sends on the read or write channels, the second goroutine would send on the pipe to wake up the poll server.\nThis is how the net package in the standard library works. I highly recommend reading it for inspiration (or stealing... the BSD license is very liberal).\nHere is a description of pollServer from net itself. You may need to read the code to understand what this is saying, but this section from fd.go should be a good place to start looking.\n// A pollServer helps FDs determine when to retry a non-blocking\n// read or write after they get EAGAIN.  When an FD needs to wait,\n// send the fd on s.cr (for a read) or s.cw (for a write) to pass the\n// request to the poll server.  Then receive on fd.cr/fd.cw.\n// When the pollServer finds that i/o on FD should be possible\n// again, it will send fd on fd.cr/fd.cw to wake any waiting processes.\n// This protocol is implemented as s.WaitRead() and s.WaitWrite().\n//\n// There is one subtlety: when sending on s.cr/s.cw, the\n// poll server is probably in a system call, waiting for an fd\n// to become ready.  It's not looking at the request channels.\n// To resolve this, the poll server waits not just on the FDs it has\n// been given but also its own pipe.  After sending on the\n// buffered channel s.cr/s.cw, WaitRead/WaitWrite writes a\n// byte to the pipe, causing the pollServer's poll system call to\n// return.  In response to the pipe being readable, the pollServer\n// re-polls its request channels.\n//\n// Note that the ordering is \"send request\" and then \"wake up server\".\n// If the operations were reversed, there would be a race: the poll\n// server might wake up and look at the request channel, see that it\n// was empty, and go back to sleep, all before the requester managed\n// to send the request.  Because the send must complete before the wakeup,\n// the request channel must be buffered.  A buffer of size 1 is sufficient\n// for any request load.  If many processes are trying to submit requests,\n// one will succeed, the pollServer will read the request, and then the\n// channel will be empty for the next process's request.  A larger buffer\n// might help batch requests.\n//\n// To avoid races in closing, all fd operations are locked and\n// refcounted. when netFD.Close() is called, it calls syscall.Shutdown\n// and sets a closing flag. Only when the last reference is removed\n// will the fd be closed.\n\nGood luck re-implementing net. The good news at the end of all this your zmq-socket will be thread safe in go."}
{"instruction": "Answer the following programming question.", "input": "I have eclipse and goclipse installed, all is well, I can run a console app in the IDE.  It is possible to execute the unit tests in the IDE too?", "output": "The latest release of goclipse (0.7.6) does provide a means of doing testing using the \"testing\" package assuming you have followed the project structure recommended in C:/Go/doc/code.html in the installed file structure created when installing Go.\nUsing the Eclipse \"run external tools\" button create a new external tool configuration as follows:\n\non the Main tab the location is C:/Go/bin/go.exe\nthe argument is test\nthe working directory should point to the eclipse workspace folder containing the package that is to be tested (eg ${workspace_loc:/goProject/src/pnp}, where pnp is the name of the package NOT the name of the go file that contains the test).\n\nYou can now run the test by pressing the Run button in the usual manner, having given the configuration a sensible name eg: go test pnp.  You can now add further tests to the package in different go files (or the same one) and all the tests will be carried out in a manner that is expected."}
{"instruction": "Answer the following programming question.", "input": "I am trying to add my project directory to GOPATH, in linux I can do  \nexport GOPATH=$HOME/mygo   in ~/.bashrc\nwhat is the equivalence in powershell", "output": "This should follow the way you set any Environment variable with Powershell (as described in this article):\nIf you want it permanent (ie will apply for any future shell):\n[Environment]::SetEnvironmentVariable(\"GOPATH\", \"C:\\Your\\Path\", \"User\")\n\n\nOne thing to watch out for: when we used SetEnvironmentVariable to create a new user- or machine-level environment variable that variable didn’t always show up when we ran this command in Windows PowerShell:\n\nGet-ChildItem Env:\n\n\nOr at least it didn’t show up until we restarted PowerShell. (Or started up a new instance of PowerShell.)\n  However, we could retrieve the value of the new variable at any time by using this command:\n\n[Environment]::GetEnvironmentVariable(\"GOPATH\",\"User\")\n\n\nIf you want it for just the current shell, as mentioned in cmotley's answer and detailed in the same article:\n$env:GOPATH = \"C:\\Your\\Path\"\n\nAs Jaykul comments, setting that line in your %UserProfile%\\My Documents\\WindowsPowerShell\\profile.ps1 is the equivalent of an export in ~\\.bashrc:\nSee \"Windows PowerShell Profiles\".\n(There are actually 4 profiles, the one profile mentioned applies only to the current user, but affects all shells)"}
{"instruction": "Answer the following programming question.", "input": "I am trying to write a go function that will read in lines in a text file, sort them (alphabetize), and overwrite them back to the file. Right now, I am able to essentially emulate cat, but I can't seem to be able to manipulate the contents of the elements in read_line. \nfunc sort() {\n\n    ff, _ := os.OpenFile(file, os.O_RDWR, 0666)\n    f := bufio.NewReader(ff)\n    for {\n        read_line, _ := f.ReadString('\\n')\n        fmt.Print(read_line)\n        if read_line == \"\" {\n            break\n        }\n    }\n    ff.Close()\n}\n\nwhen i use ReadString, how can i store each line into a slice (or is there a better way to store them so i can manipulate them)? Then I would use the sort package in a manner similar to this:\nsorted := sort.Strings(lines) \n\nthen, to write to the file, i am using something similar to the following, although i have not included it because i have not yet gotten \"sort\" to work:\nio.WriteString(ff, (lines + \"\\n\"))\n\nThank you in advance for any suggestions!", "output": "For example,\npackage main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"sort\"\n)\n\nfunc readLines(file string) (lines []string, err os.Error) {\n    f, err := os.Open(file)\n    if err != nil {\n        return nil, err\n    }\n    defer f.Close()\n    r := bufio.NewReader(f)\n    for {\n        const delim = '\\n'\n        line, err := r.ReadString(delim)\n        if err == nil || len(line) > 0 {\n            if err != nil {\n                line += string(delim)\n            }\n            lines = append(lines, line)\n        }\n        if err != nil {\n            if err == os.EOF {\n                break\n            }\n            return nil, err\n        }\n    }\n    return lines, nil\n}\n\nfunc writeLines(file string, lines []string) (err os.Error) {\n    f, err := os.Create(file)\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n    w := bufio.NewWriter(f)\n    defer w.Flush()\n    for _, line := range lines {\n        _, err := w.WriteString(line)\n        if err != nil {\n            return err\n        }\n    }\n    return nil\n}\n\nfunc main() {\n    file := `lines.txt`\n    lines, err := readLines(file)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    sort.Strings(lines)\n    err = writeLines(file, lines)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n}"}
{"instruction": "Answer the following programming question.", "input": "I have the following function that is giving me \"variable declared and not used\" errors:\ntype Comparison struct {\n        Left []byte\n        Right []byte\n        Name string\n}\n\nfunc img(w http.ResponseWriter, r *http.Request, c appengine.Context, u *user.User) {\n  key := datastore.NewKey(\"Comparison\", r.FormValue(\"id\"), 0, nil)\n  side := r.FormValue(\"side\")\n  comparison := new(Comparison)\n  err := datastore.Get(c, key, comparison)\n  check(err)\n\n  if( side == \"left\"){\n    m, _, err := image.Decode(bytes.NewBuffer(comparison.Left))\n  } else {\n    m, _, err := image.Decode(bytes.NewBuffer(comparison.Right))\n  }\n  check(err)\n\n  w.Header().Set(\"Content-type\", \"image/jpeg\")\n  jpeg.Encode(w, m, nil)\n}\n\nIt gives me the following errors:\ndpcompare.go:171: m declared and not used\ndpcompare.go:171: err declared and not used\ndpcompare.go:173: m declared and not used\ndpcompare.go:173: err declared and not used\ndpcompare.go:178: undefined: m\ndpcompare.go:185: key declared and not used\n\nThe thing is m, err, and key are all being used. I can't wrap my head around why the compiler thinks thy are not.", "output": "As @kostix said, m is local to the scope of the if. Try this code\ntype Comparison struct {\n        Left []byte\n        Right []byte\n        Name string\n}\n\nfunc img(w http.ResponseWriter, r *http.Request, c appengine.Context, u *user.User) {\n  key := datastore.NewKey(\"Comparison\", r.FormValue(\"id\"), 0, nil)\n  side := r.FormValue(\"side\")\n  comparison := new(Comparison)\n  err := datastore.Get(c, key, comparison)\n  check(err)\n\n  // NOTE! now m is in the function's scope\n  var m Image    \n  if( side == \"left\"){\n    m, _, err = image.Decode(bytes.NewBuffer(comparison.Left))\n  } else {\n    m, _, err = image.Decode(bytes.NewBuffer(comparison.Right))\n  }\n  check(err)\n\n  w.Header().Set(\"Content-type\", \"image/jpeg\")\n  jpeg.Encode(w, m, nil)\n}"}
{"instruction": "Answer the following programming question.", "input": "In languages with automatic garbage collection like Haskell or Go, how can the garbage collector find out which values stored on the stack are pointers to memory and which are just numbers? If the garbage collector just scans the stack and assumes all addresses to be references to objects, a lot of objects might get incorrectly marked as reachable.\nObviously, one could add a value to the top of each stack frame that described how many of the next values are pointers, but wouldn't that cost a lot of performance?\nHow is it done in reality?", "output": "There exist GCs that assume that every bit pattern that is the address of something the GC is managing is in fact a pointer (and so don't release the something). This can actually work pretty well, because calls pointers are usually bigger than small common integers, and usually have to be aligned. But yes, this can cause collection of some objects to be delayed. The Boehm collector for C works this way, because it's library-based and so don't get any specific help from the compiler.\nThere are also GCs that are more tightly coupled to the language they're used in, and actually know the structure of the objects in memory. I've never read up specifically in stack frame handling, but you could record information to help the GC if the compiler and GC are designed to work together. One trick would be putting all the pointer references together and using one word per stack frame to record how many there are, which is not such a huge overhead. If you can work out what function corresponds to each stack frame without adding a word saying so, then you could have a per-function \"stack frame layout map\" compiled in. Another option would be to use tagged words, where you set the low order bit of words that are not pointers to 1, which (due to address alignment) is never needed for pointers, so you can tell them apart. That means you have to shift unboxed values in order to use them though."}
{"instruction": "Answer the following programming question.", "input": "Does anyone know of a way to read the metadata and or properties of a file using the go language?", "output": "package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    fi, err := os.Stat(\"filename\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(fi.Name(), fi.Size())\n}"}
{"instruction": "Answer the following programming question.", "input": "Does Go language use Copy-on-write for strings as in Java? I.e. if I pass a string by value to a method and never change it will this allocate memory and copy the string (which will be time inefficient) or it will just reference a single copy.", "output": "It's not Copy-on-Write, as strings are immutable. But sharing a string will not make a copy of the underlying memory region either. In Go, a string is represented as a (length, data) pair. If you pass a string around, Go will copy the length and the pointer but not the data pointed to.\nFor further information, see this recent thread on golang-nuts."}
{"instruction": "Answer the following programming question.", "input": "I'm a Go newcomer, but I have read that Go regulars do not miss parametric polymorphism. Every time I try to learn a new language I use the L99 list of problems to get some practice.\nEven if I try to write something as trivial as the first problem (which in Go would be a single statement, taking the last element of a slice), how would I write this as a function that takes a slice of any type and (using that single statement I referenced above) returns the last element of that slice?\nI figured even though the language does not have parametric polymorphism there must be some idiomatic 'Go' way of  doing this in order for Go regulars to claim they dont miss parametric polymorphism. Otherwise, if the example were more complex than just the last element of a list for instance, you would need a function to perform your task for every type. \nWhat am I missing?", "output": "You cite the \"99 lisp problems\", yet Lisp does not have parametric polymorphism or static types at all.\nMany statically-typed languages, like Objective-C, and Java before generics, have no parametric polymorphism. The solution is to just use a type that can accept all values, which in Go is interface{}, and cast when you need to get some specific type out of it.\nFor your specific question, how to take \"any type of slice\"; unfortunately, there is no interface that includes specifically slices, since slices do not have any methods; so you'll be stuck with using interface{}. Since you have an unknown slice type, you need to use reflection (the reflect package) to perform all the slice operations, including getting the length and capacity, appending, and accessing the element at a particular index.\nAnother alternative is that instead of using \"slice of any type\", just use \"slice of interface{}\" i.e. []interface{}, in all your code, then you can use the normal slice operators on it, and you can put any elements in, but cast when you get them out."}
{"instruction": "Answer the following programming question.", "input": "I got the runtime error message Write T1 binary.Read: invalid type main.T1\npackage main\n\nimport (\n    \"encoding/binary\"\n    \"net\"\n)\n\ntype T1 struct {\n    f1 [5]byte\n    f2 int\n}\n\nfunc main() {\n    conn, _ := net.Dial(\"tcp\", \":12345\")\n    l1 := T1{[5]byte{'a', 'b', 'c', 'd', 'e'}, 1234}\n    binary.Write(conn, binary.BigEndian, &l1)\n}\n\nI wish to use the endian auto convert function, how could I do?\nBy the way, is there more efficient way?", "output": "Use exported fixed size fields. For example,\npackage main\n\nimport (\n    \"bytes\"\n    \"encoding/binary\"\n    \"fmt\"\n)\n\ntype T struct {\n    F1 [5]byte\n    F2 int32\n}\n\nfunc main() {\n    var t1, t2 T\n    t1 = T{[5]byte{'a', 'b', 'c', 'd', 'e'}, 1234}\n    fmt.Println(\"t1:\", t1)\n    buf := new(bytes.Buffer)\n    err := binary.Write(buf, binary.BigEndian, &t1)\n    if err != nil {\n        fmt.Println(err)\n    }\n    err = binary.Read(buf, binary.BigEndian, &t2)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(\"t2:\", t2)\n}\n\nOutput:\nt1: {[97 98 99 100 101] 1234}\nt2: {[97 98 99 100 101] 1234}"}
{"instruction": "Answer the following programming question.", "input": "When I try to compile the example from the front page of the go language website with the 6g compiler, I get this error:\nhello.go:5: syntax error near \"<string>\"\nI search on Google reveals that a few people have experienced this, but I have found no solution. The answer always seems to be: \"It's works for me, you must do something wrong\". \nI've found a description of the problem that dates back 5 months, so I suspect it's not a problem with the particular build of go that I'm using. Besides, I've tried pulling a newer version, and the problem persists.\nThe source code in question:\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello, 世界\")\n }\n\nBtw, I'm saving the source code as UTF-8 with LFs for newlines. It shouldn't be a text encoding issue. I've also tried with different strings not containing \"exotic\" characters", "output": "Try \"which 6g\".\nYou might be picking up an old build.\nAt least that was my case. I had an old 2009 build in my path.\nAfter fixing the environment it worked."}
{"instruction": "Answer the following programming question.", "input": "I try to write a small application in go that takes 'x' numbers of integers from standard input, calculates the mean and gives it back. I have only gotten so far:\nfunc main() {\nvar elems, mean int\nsum := 0\n\nfmt.Print(\"Number of elements? \")\n\nfmt.Scan(&elems)\n\nvar array = new([elems]int)\n\nfor i := 0; i < elems; i++ {\n    fmt.Printf(\"%d . Number? \", i+1)\n    fmt.Scan(&array[i])\n    sum += array[i];\n}............\n\nWhen trying to compile this I get the following error message:\n\ninvalid array bound elems\n\nWhat is wrong here?", "output": "You should use a slice instead of an array:\n//var array = new([elems]int) - no, arrays are not dynamic\nvar slice = make([]int,elems) // or slice := make([]int, elems)\n\nSee \"go slices usage and internals\". Also you may want to consider using range for your loop:\n// for i := 0; i < elems; i++ { - correct but less idiomatic\nfor i, v := range slice {"}
{"instruction": "Answer the following programming question.", "input": "In the following go snippet, what am I doing wrong?\ntype Element interface{}\n\nfunc buncode(in *os.File) (e Element) {\n    <snip>\n    e = make(map[string]interface{})\n    for {\n        var k string = buncode(in).(string)\n        v := buncode(in)\n        e[k] = v\n    }\n    <snip>\n}\n\nCompiling gives me this error:\ngopirate.go:38: invalid operation: e[k] (index of type Element)\n\nDouble ewe T eff?", "output": "In the buncode function you declare e Element, where type e Element interface{}. The variable e is a scalar value, which you are trying to index.\n\nTypes\nThe static type (or just type) of a variable is the type defined by\n  its declaration. Variables of interface type also have a distinct\n  dynamic type, which is the actual type of the value stored in the\n  variable at run-time. The dynamic type may vary during execution but\n  is always assignable to the static type of the interface variable. For\n  non-interface types, the dynamic type is always the static type.\n\nThe static type of e is Element, a scalar. The dynamic type of e is map[string]interface{}.\nHere's a revised, compilable version of your code.\ntype Element interface{}\n\nfunc buncode(in *os.File) (e Element) {\n    m := make(map[string]interface{})\n    for {\n        var k string = buncode(in).(string)\n        v := buncode(in)\n        m[k] = v\n    }\n    return m\n}\n\nWhy are you making the recursive calls to buncode?"}
{"instruction": "Answer the following programming question.", "input": "I'm sending a reply to a request over a chan X, where X is a struct. The request is a search operation, so ideally I'd like to be able to return either an X, or report it wasn't found.\nThis would be a task for a Maybe X in Haskell or an x option in OCaml. Is there any decent way to do this in Go? I'm not returning a pointer (as the original object I'm returning might be modified later), so I can't just return nil.\nEdit: right now I'm making it a chan interface{} and either sending an X or nil, but this is ugly and defeats type-safety.", "output": "If you're using interface {} you're effectively returning a pointer now. Why not change interface {} to *X and make sure to return a copy of the object? If I understand your reasoning behind not using a chan *X, that is."}
{"instruction": "Answer the following programming question.", "input": "I am just playing around with Go and do not yet have a good mental model of when structs are passed by value or by reference.\nThis may be a very dumb question but I just want to experiment a bit and see if I am still working on the same object or I have made a copy of it (passed it by value).\nIs there a way to print the pointer (or internal id if pointer value is changed by gc) of an object?\npackage main\n\nimport ( \"runtime\" )\n\ntype Something struct {\n    number int\n    queue chan int\n}\n\nfunc gotest( s *Something, done chan bool ) {\n    println( \"from gotest:\")\n    println( &s )\n    for num := range s.queue {\n        println( num )\n        s.number = num\n    }\n    done <- true\n}\n\nfunc main() {\n    runtime.GOMAXPROCS(4)\n    s := new(Something)\n    println(&s)\n    s.queue = make(chan int)\n    done := make(chan bool)\n    go gotest(s, done)\n    s.queue <- 42\n    close(s.queue)\n    <- done\n    println(&s)\n    println(s.number)\n}\n\ngives on my windows (8g compiled version):\n0x4930d4\nfrom gotest:\n0x4974d8\n42\n0x4930d4\n42\n\nWhy does the pointer value from within the go routine show a different value? The quantity on the original object did get changed so it was working with the same object. Is there a way to see an object id that is persistent?", "output": "Go function arguments are passed by value.\nFirst, let's discard the irrelevant parts of your example, so that we can easily see that you are merely passing an argument by value. For example,\npackage main\n\nimport \"fmt\"\n\nfunc byval(q *int) {\n    fmt.Printf(\"3. byval -- q %T: &q=%p q=&i=%p  *q=i=%v\\n\", q, &q, q, *q)\n    *q = 4143\n    fmt.Printf(\"4. byval -- q %T: &q=%p q=&i=%p  *q=i=%v\\n\", q, &q, q, *q)\n    q = nil\n}\n\nfunc main() {\n    i := int(42)\n    fmt.Printf(\"1. main  -- i  %T: &i=%p i=%v\\n\", i, &i, i)\n    p := &i\n    fmt.Printf(\"2. main  -- p %T: &p=%p p=&i=%p  *p=i=%v\\n\", p, &p, p, *p)\n    byval(p)\n    fmt.Printf(\"5. main  -- p %T: &p=%p p=&i=%p  *p=i=%v\\n\", p, &p, p, *p)\n    fmt.Printf(\"6. main  -- i  %T: &i=%p i=%v\\n\", i, &i, i)\n}\n\nOutput:\n1. main  -- i  int: &i=0xf840000040 i=42\n2. main  -- p *int: &p=0xf8400000f0 p=&i=0xf840000040  *p=i=42\n3. byval -- q *int: &q=0xf8400000d8 q=&i=0xf840000040  *q=i=42\n4. byval -- q *int: &q=0xf8400000d8 q=&i=0xf840000040  *q=i=4143\n5. main  -- p *int: &p=0xf8400000f0 p=&i=0xf840000040  *p=i=4143\n6. main  -- i  int: &i=0xf840000040 i=4143\n\nIn function main, i is an int variable at memory location (&i) 0xf800000040 with an initial value (i) 42.\nIn function main, p is a pointer to an int variable at memory location (&p) 0xf8000000f0 with a value (p=&i) 0xf800000040 which points to an int value (*p=i) 42.\nIn function main, byval(p) is a function call which assigns the value (p=&i) 0xf800000040 of the argument at memory location (&p) 0xf8000000f0 to the function byval parameter q at memory location (&q) 0xf8000000d8. In other words, memory is allocated for the byval parameter q and the value of the main byval argument p is assigned to it; the values of p and q are initially the same, but the variables p and q are distinct.\nIn function byval, using pointer q (*int), which is a copy of pointer p (*int), integer *q (i) is set to a new int value 4143. At the end before returning. the pointer q is set to nil (zero value), which has no effect on p since q is a copy.\nIn function main, p is a pointer to an int variable at memory location (&p) 0xf8000000f0 with a value (p=&i) 0xf800000040 which points to a new int value (*p=i) 4143.\nIn function main, i is an int variable at memory location (&i) 0xf800000040 with a final value (i) 4143.\nIn your example, the function main variable s used as an argument to the function gotest call is not the same as the function gotest parameter s. They have the same name, but are different variables with different scopes and memory locations. The function parameter s hides the function call argument s. That's why in my example, I named the argument and parameter variables p and q respectively to emphasize the difference.\nIn your example, (&s) 0x4930d4 is the address of the memory location for the variable s in function main that is used as an argument to the function call gotest(s, done), and 0x4974d8 is the address of the memory location for the function gotest parameter s. If you set parameter s = nil at the end of function gotest, it has no effect on variable s in main; s in main and s in gotest are distinct memory locations. In terms of types, &s is **Something, s is *Something, and *s is Something. &s is a pointer to (address of memory location) s, which is a pointer to (address of memory location) an anonymous variable of type Something. In terms of values, main.&s != gotest.&s, main.s == gotest.s, main.*s == gotest.*s, and main.s.number == gotest.s.number.\nYou should take mkb's sage advice and stop using println(&s). Use the fmt package, for example,\nfmt.Printf(\"%v %p %v\\n\", &s, s, *s)\n\nPointers have the same value when they point to the same memory location; pointers have different values when they point to different memory locations."}
{"instruction": "Answer the following programming question.", "input": "Is there a way to download a large file using Go that will store the content directly into a file instead of storing it all in memory before writing it to a file? Because the file is so big, storing it all in memory before writing it to a file is going to use up all the memory.", "output": "I'll assume you mean download via http (error checks omitted for brevity):\nimport (\"net/http\"; \"io\"; \"os\")\n...\nout, err := os.Create(\"output.txt\")\ndefer out.Close()\n...\nresp, err := http.Get(\"http://example.com/\")\ndefer resp.Body.Close()\n...\nn, err := io.Copy(out, resp.Body)\n\nThe http.Response's Body is a Reader, so you can use any functions that take a Reader, to, e.g. read a chunk at a time rather than all at once. In this specific case, io.Copy() does the gruntwork for you."}
{"instruction": "Answer the following programming question.", "input": "In the Go tutorial, and most of the Go code I've looked at, packages are imported like this:\nimport (\n    \"fmt\"\n    \"os\"\n    \"launchpad.net/lpad\"\n    ...\n)\n\nBut in http://bazaar.launchpad.net/~niemeyer/lpad/trunk/view/head:/session_test.go, the gocheck package is imported with a . (period):\nimport (\n    \"http\"\n    . \"launchpad.net/gocheck\"\n    \"launchpad.net/lpad\"\n    \"os\"    \n)\n\nWhat is the significance of the . (period)?", "output": "It allows the identifiers in the imported package to be referred to in the local file block without a qualifier.\n\nIf an explicit period (.) appears instead of a name, all the package's exported identifiers will be declared in the current file's file block and can be accessed without a qualifier.\nAssume we have compiled a package containing the package clause package math, which exports function Sin, and installed the compiled package in the file identified by \"lib/math\". This table illustrates how Sin may be accessed in files that import the package after the various types of import declaration.\n\nImport declaration          Local name of Sin\n\nimport   \"lib/math\"         math.Sin\nimport M \"lib/math\"         M.Sin\nimport . \"lib/math\"         Sin\n\nRef: http://golang.org/doc/go_spec.html#Import_declarations"}
{"instruction": "Answer the following programming question.", "input": "I have the following simple golang program to download Google's privacy policy. Unfortunately it always crashes with the error unexpected EOF after reading 6861 bytes, even though the document is much longer. Why?\npackage main\n\nimport \"net\"\nimport \"fmt\"\nimport \"io\"\nimport \"os\"\n\nfunc die(msg string, s os.Error) {\n    fmt.Printf(\"%s crashed: %v\\n\", msg, s)\n    os.Exit(1)\n}\n\nfunc main() {\n    fd, err := net.Dial(\"tcp\", \"google.com:80\")\n    if err != nil { die(\"dial\", err) }\n\n    req := []byte(\"GET /intl/en/privacy/ HTTP/1.0\\r\\nHost: www.google.com\\r\\n\\r\\n\")\n    _, err = fd.Write(req)\n    if err != nil { die(\"dial write\", err) }\n\n    buf := make([]byte, 1024)\n    nr := 1\n\n    for nr > 0 {\n        nr, err = io.ReadFull(fd, buf)\n        if err != nil { die(\"dial read\", err) }\n        fmt.Printf(\"read %d\\n\", nr)\n    }\n}\n\noutputs:\nread 1024\nread 1024\nread 1024\nread 1024\nread 1024\nread 1024\ndial read crashed: unexpected EOF", "output": "Function io.ReadFull(fd, buf) should be used only when you know that fd can feed at least len(buf) bytes.\nInstead, try the following:\nvar buf bytes.Buffer\n\nnr, err := io.Copy(&buf, fd)\nif err != nil {\n    die(\"dial read\", err)\n}\n\nIf copying to a file, use an os.File instead of bytes.Buffer."}
{"instruction": "Answer the following programming question.", "input": "What difference there is when you access to another struct by value or by a pointer?\nWhen should be used each one of them?\ntype foo_ struct {\n    st uint8\n    nd uint8\n}\n\ntype bar struct {\n    rd  uint8\n    foo foo_\n}\n\ntype barP struct {\n    rd  uint8\n    foo *foo_\n}", "output": "If you declare or allocate a variable of type bar, you reserve and initialize to zero memory for both rd uint8 and foo foo_. There is always one variable of type foo_ embedded in a variable of type bar.\nvar b bar  // declare b\n\nIf you declare or allocate a variable of type barP, you reserve and initialize to zero memory for both rd uint8 and foo *foo_. A zero value pointer is a nil pointer. No variable of type foo_ is allocated; you must do that separately. There is either zero (foo == nil) or one variable of type foo_ pointed to by a variable of type barP. A variable of type barP may point to the same variable of type foo_ as other variables of type barP, sharing the same copy of the variable of type foo_. A change to a shared copy is seen by all variables that point to it. \nvar bp barP         // declare bp\nbp.foo = new(foo_)  // allocate bp.foo\n\nWhich one to use depends on the properties of type bar versus type barP. Which type more closely reflects the problem that you are trying to solve?\nFor example, consider this invoice problem. We always have a billing address; we are always going to ask for our money. However, we often ship to the billing address, but not always. If the shipping address is nil, use the billing address. Otherwise, use a separate shipping address. We have two warehouses, and we always ship from one or the other. We can share the two warehouse locations. Since we don't send an invoice until the order is shipped from the warehouse, the warehouse location will never be nil.\ntype address struct {\n    street string\n    city   string\n}\n\ntype warehouse struct {\n    address string\n}\n\ntype invoice struct {\n    name      string\n    billing   address\n    shipping  *address\n    warehouse *warehouse\n}"}
{"instruction": "Answer the following programming question.", "input": "I am trying to convert my node.js HTTP server to Go.  Here's what I want to happen:\nI have a resource that gets generated intermittently (say every second or so), and I want all requests for this resource to wait until the next time it is generated.  This way clients can poll and be guaranteed to get only the up-to-date resource.  I am using web.go to remove a lot of the complexity of running an HTTP server.\nHere is a brief version of my code:\npackage main\n\nimport (\n    \"time\"\n    \"web\"\n    \"fmt\"\n    vector \"container/vector\"\n)\n\nvar listeners vector.Vector;\n\nfunc resource (ctx *web.Context) {\n    c := make(chan int)\n    listeners.Push(c)\n    go func() {\n        <-c\n        go func() {\n            ctx.WriteString(\"Cool\")\n            fmt.Println(\"Wrote something\")\n        }()\n    }()\n}\n\nfunc resourceLoop() {\n    time.Sleep(5 * 1000 * 1000000) // sleep for 5 seconds\n    for ; listeners.Len() > 0 ; {\n        c := listeners.Pop().(chan int)\n        c <- 1\n    }\n\n    go resourceLoop()\n}\n\nfunc main() {\n    web.Get(\"/resource\", resource)\n\n    go resourceLoop()\n\n    web.Run(\"localhost:4000\")\n}\n\nI would expect there to be a Context.End() or similar function, but it doesn't seem to have one.  I read the source for web.go, but I couldn't figure out where it was ending the response (web.go:268 is where my resource() is called).  In node.js this is trivial, you can call a ServerResponse.end().\nWhen I kill the server while running the script in Chrome, I get this output (seems to be correct, except that the response isn't ending):\n4\nCool\nHTTP/1.1 200 OK\nContent-Type: text/html; charset=utf-8\nDate: Sat, 16 Apr 2011 00:37:58 GMT\nServer: web.go\nTransfer-Encoding: chunked\n\n0\n\nIs this a problem with the web.go framework or am I doing something wrong?  If it's a problem with the framework, I'll file an issue with him.\nI'm pretty new to Go, so I could be going about this completely wrong.", "output": "I've never used web.go, but it seems that your example is entirely too complicated.  Why do you need a goroutine to spawn a goroutine?  I would assume the framework itself would take care of concurrency and just write this:\nfunc resource (ctx *web.Context, val string) string {\n    c := make(chan int)\n    listeners.Push(c)\n    <-c\n    return \"Cool\"\n}\n\nOtherwise, it looks like it is doing exactly what you want and you just need to close the connection if you're truly done with it:\nctx.Close()"}
{"instruction": "Answer the following programming question.", "input": "I'm trying to set cookies with Go's net/http package. I have:\npackage main\n\nimport \"io\"\nimport \"net/http\"\nimport \"time\"\n\nfunc indexHandler(w http.ResponseWriter, req *http.Request) {\n    expire := time.Now().AddDate(0, 0, 1)\n    cookie := http.Cookie{\"test\", \"tcookie\", \"/\", \"www.domain.com\", expire, expire.Format(time.UnixDate), 86400, true, true, \"test=tcookie\", []string{\"test=tcookie\"}}\n    req.AddCookie(&cookie)\n    io.WriteString(w, \"Hello world!\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", indexHandler)\n    http.ListenAndServe(\":80\", nil)\n}\n\nI tried googling 'Golang' with 'cookies', but didn't get any good results. If anyone can point me in the right direction it would be greatly appreciated.", "output": "I am not a Go expert, but I think you are setting the cookie on the request, aren't you? You might want to set it on the response. There is a setCookie function in net/http. This might help:\nhttp://golang.org/pkg/net/http/#SetCookie\nfunc SetCookie(w ResponseWriter, cookie *Cookie)"}
{"instruction": "Answer the following programming question.", "input": "I've only just recently learned about Google's programming language, Go.  I've been intrigued by its offered support for concurrency, and set out to learn more about it.  However, I went looking to see how Go implemented a particular feature of concurrency, and so far I haven't seen any evidence at all that this feature is there at all.\nHere's a hypothetical situation:  suppose we are programming a function to determine the Foo value of a particular input.  For any given input, the Foo value is found either in domain A, or domain B (not in both).  The techniques of searching in these domains are quite different, but they share the property that successful searches tend to return quickly, while unsuccessful searches must go through the entire dataset to be exhaustive and therefore take a long time.\nNow, in other languages that employ concurrency (such as Cilk) one could program the function Foosearch so that it spawned an Asearch function and a Bsearch function.  These functions would run concurrently, and whenever either of them came up with an answer, that answer would be reported to the calling function Foosearch, which would terminate any functions it had spawned that had not returned.\nWith Go's goroutines, however, it looks like you can only connect two routines with a channel - so you couldn't set up a channel to which either Asearch or Bsearch could send, depending on which found an answer first, and have Foosearch read from it.  It also looks like you can't read from a channel without blocking on it - so you couldn't have Foosearch start Asearch and Bsearch and set up channels from both, then run in a loop checking to see if one or the other has produced an answer.\nIs my understanding of the limits of Go's concurrency correct?  Is there another way to achieve the given result?", "output": "No, I don't believe your understanding of the limits of Go is correct.\nFor one thing, there's nothing I've seen in Go that limits channels to communicating between two routines. You can pass the same channel to both Asearch and Bsearch, and then whichever one finishes can send the result on that channel.\nIf instead you wanted to use two channels, and wait for one of them to get the result, you could just use the select statement. From the Go tutorial, an example selecting on a channel used to send requests, and one used to signal the server to quit:\n21    func server(op binOp, service chan *request, quit chan bool) {\n22        for {\n23            select {\n24            case req := <-service:\n25                go run(op, req);  // don't wait for it\n26            case <-quit:\n27                return;\n28            }\n29        }\n30    }\n\nFurthermore, while receives from a channel normally block, you can also do a non-blocking receive from a channel.\n\nIf a receive expression is used in an\n  assignment or initialization of the\n  form\nx, ok = <-ch\nx, ok := <-ch\nvar x, ok = <-ch\n\nthe receive operation becomes\n  non-blocking. If the operation can\n  proceed, the boolean variable ok will\n  be set to true and the value stored in\n  x; otherwise ok is set to false and x\n  is set to the zero value for its type\n  (§The zero value).\n\nSo, there are several ways to wait for the result from multiple goroutines without blocking. I think I'd go with multiple channels multiplexed using select, as that way you can easily tell which routine returned the result without having to package that information into the value you're sending or doing some other form of out-of-band communication."}
{"instruction": "Answer the following programming question.", "input": "Sorry for the basic question. I'd like to pass a slice as arguments to fmt.Sprintf. Something like this:\nvalues := []string{\"foo\", \"bar\", \"baz\"}\nresult := fmt.Sprintf(\"%s%s%s\", values...)\n\nAnd the result would be foobarbaz, but this obviously doesn't work.\n(the string I want to format is more complicated than that, so a simple concatenation won't do it :)\nSo the question is: if I have am array, how can I pass it as separated arguments to fmt.Sprintf? Or: can I call a function passing an list of arguments in Go?", "output": "As you found out on IRC, this will work:\nvalues := []interface{}{\"foo\", \"bar\", \"baz\"}\nresult := fmt.Sprintf(\"%s%s%s\", values...)\n\nYour original code doesn't work because fmt.Sprintf accepts a []interface{} and []string can't be converted to that type, implicitly or explicitly."}
{"instruction": "Answer the following programming question.", "input": "I have an http server (launched using http.Handle) and I would like to do some operations.\nHow can I do that (on linux) ? Is it possible to do those operations in case of a ctrl-C ?\nI'm not familiar with unix signals so the answer may be trivial.", "output": "You can subscribe to the TERM and INT signals using the signal package. But note that these signals are only sent when the process is killed explicitly; normal exit (initiated by the process itself) does not involve any sort of signals.  I think for normal exit just do something in the main routine (which supposedly should spawn worker goroutines and then wait on them).\nRead man 7 signal for more general info on POSIX signals."}
{"instruction": "Answer the following programming question.", "input": "I need help understanding how to demonize a process in Go.\npackage main\n\nimport (\n   \"fmt\"\n   \"os\"\n)\n\nfunc start() {\n   var procAttr os.ProcAttr \n   procAttr.Files = []*os.File{nil, nil, nil}\n   _, err := os.StartProcess(\"/Path/prog\", nil, &procAttr)\n   if err != nil {\n       fmt.Printf(\"%v\", err)\n   }\n}\n\n\nfunc main () {\n   start()\n} \n\nIf you start this code on the command line the program returns control, but is still connected with cmd. Closing the cmd closes the program.\nHow can I decouple it from the cmd?  Adding:\nprocAttr.Sys.HideWindow = true\n\nResults in this error: \"panic\" to wrong memory pointer", "output": "I asked in 'golang-nuts', and found out that Go has a link option:\ngo tool 8l -o output.exe -Hwindowsgui input.8"}
